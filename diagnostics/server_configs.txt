Generated on 2025-08-10 15:45:32 by root

[32m[INFO] === SERVER CONFIGS ===(B[m

# --- update_cf_ufw.sh target ---
lrwxrwxrwx 1 root root 39 Aug 10 12:01 /usr/local/sbin/update_cf_ufw.sh -> /opt/socks5tun/scripts/update_cf_ufw.sh
/opt/socks5tun/scripts/update_cf_ufw.sh

# --- dpkg (net) ---
ii  bind9                           1:9.18.30-0ubuntu0.24.04.2                  amd64        Internet Domain Name Server
ii  bind9-dnsutils                  1:9.18.30-0ubuntu0.24.04.2                  amd64        Clients provided with BIND 9
ii  bind9-host                      1:9.18.30-0ubuntu0.24.04.2                  amd64        DNS Lookup Utility
ii  bind9-libs:amd64                1:9.18.30-0ubuntu0.24.04.2                  amd64        Shared Libraries used by BIND 9
ii  bind9-utils                     1:9.18.30-0ubuntu0.24.04.2                  amd64        Utilities for BIND 9
ii  charon-systemd                  5.9.13-2ubuntu4                             amd64        strongSwan IPsec client, systemd support
ii  grafana                         12.1.0                                      amd64        Grafana
ii  iptables                        1.8.10-3ubuntu2                             amd64        administration tools for packet filtering and NAT
ii  libcharon-extauth-plugins       5.9.13-2ubuntu4                             amd64        strongSwan charon library (extended authentication plugins)
ii  libcharon-extra-plugins         5.9.13-2ubuntu4                             amd64        strongSwan charon library (extra plugins)
ii  libstrongswan                   5.9.13-2ubuntu4                             amd64        strongSwan utility and crypto library
ii  libstrongswan-extra-plugins     5.9.13-2ubuntu4                             amd64        strongSwan utility and crypto library (extra plugins)
ii  libstrongswan-standard-plugins  5.9.13-2ubuntu4                             amd64        strongSwan utility and crypto library (standard plugins)
ii  net-tools                       2.10-0.1ubuntu4.4                           amd64        NET-3 networking toolkit
ii  nginx                           1.24.0-2ubuntu7.4                           amd64        small, powerful, scalable web/proxy server
ii  nginx-common                    1.24.0-2ubuntu7.4                           all          small, powerful, scalable web/proxy server - common files
ii  strongswan                      5.9.13-2ubuntu4                             all          IPsec VPN solution metapackage
ii  strongswan-charon               5.9.13-2ubuntu4                             amd64        strongSwan Internet Key Exchange daemon
ii  strongswan-libcharon            5.9.13-2ubuntu4                             amd64        strongSwan charon library
ii  strongswan-pki                  5.9.13-2ubuntu4                             amd64        strongSwan IPsec client, pki command
ii  strongswan-starter              5.9.13-2ubuntu4                             amd64        strongSwan daemon starter and configuration file parser
ii  strongswan-swanctl              5.9.13-2ubuntu4                             amd64        strongSwan IPsec client, swanctl command

# --- nft list ruleset ---
table ip filter {
	chain ufw-before-logging-input {
	}

	chain ufw-before-logging-output {
	}

	chain ufw-before-logging-forward {
	}

	chain ufw-before-input {
		iifname "lo" counter packets 1201849 bytes 180189042 accept
		ct state related,established counter packets 908502 bytes 382049043 accept
		ct state invalid counter packets 2476 bytes 988356 jump ufw-logging-deny
		ct state invalid counter packets 2476 bytes 988356 drop
		ip protocol icmp icmp type destination-unreachable counter packets 0 bytes 0 accept
		ip protocol icmp icmp type time-exceeded counter packets 0 bytes 0 accept
		ip protocol icmp icmp type parameter-problem counter packets 0 bytes 0 accept
		ip protocol icmp icmp type echo-request counter packets 24198 bytes 1633992 accept
		udp sport 67 udp dport 68 counter packets 0 bytes 0 accept
		counter packets 75565 bytes 7804706 jump ufw-not-local
		ip daddr 224.0.0.251 udp dport 5353 counter packets 0 bytes 0 accept
		ip daddr 239.255.255.250 udp dport 1900 counter packets 0 bytes 0 accept
		counter packets 75565 bytes 7804706 jump ufw-user-input
	}

	chain ufw-before-output {
		oifname "lo" counter packets 1201849 bytes 180189042 accept
		ct state related,established counter packets 914583 bytes 282534814 accept
		counter packets 20841 bytes 1787204 jump ufw-user-output
	}

	chain ufw-before-forward {
		ct state related,established counter packets 0 bytes 0 accept
		ip protocol icmp icmp type destination-unreachable counter packets 0 bytes 0 accept
		ip protocol icmp icmp type time-exceeded counter packets 0 bytes 0 accept
		ip protocol icmp icmp type parameter-problem counter packets 0 bytes 0 accept
		ip protocol icmp icmp type echo-request counter packets 0 bytes 0 accept
		counter packets 0 bytes 0 jump ufw-user-forward
	}

	chain ufw-after-input {
		udp dport 137 counter packets 20 bytes 1560 jump ufw-skip-to-policy-input
		udp dport 138 counter packets 0 bytes 0 jump ufw-skip-to-policy-input
		tcp dport 139 counter packets 70 bytes 3516 jump ufw-skip-to-policy-input
		tcp dport 445 counter packets 208 bytes 10052 jump ufw-skip-to-policy-input
		udp dport 67 counter packets 0 bytes 0 jump ufw-skip-to-policy-input
		udp dport 68 counter packets 0 bytes 0 jump ufw-skip-to-policy-input
		fib daddr type broadcast counter packets 0 bytes 0 jump ufw-skip-to-policy-input
	}

	chain ufw-after-output {
	}

	chain ufw-after-forward {
	}

	chain ufw-after-logging-input {
		limit rate 3/minute burst 10 packets counter packets 464 bytes 97319 log prefix "[UFW BLOCK] "
	}

	chain ufw-after-logging-output {
	}

	chain ufw-after-logging-forward {
		limit rate 3/minute burst 10 packets counter packets 0 bytes 0 log prefix "[UFW BLOCK] "
	}

	chain ufw-reject-input {
	}

	chain ufw-reject-output {
	}

	chain ufw-reject-forward {
	}

	chain ufw-track-input {
	}

	chain ufw-track-output {
		ip protocol tcp ct state new counter packets 7385 bytes 526019 accept
		ip protocol udp ct state new counter packets 12752 bytes 1211688 accept
	}

	chain ufw-track-forward {
	}

	chain INPUT {
		type filter hook input priority filter; policy drop;
		counter packets 2212590 bytes 572665139 jump ufw-before-logging-input
		counter packets 2212590 bytes 572665139 jump ufw-before-input
		counter packets 46082 bytes 6098173 jump ufw-after-input
		counter packets 45784 bytes 6083045 jump ufw-after-logging-input
		counter packets 45784 bytes 6083045 jump ufw-reject-input
		counter packets 45784 bytes 6083045 jump ufw-track-input
	}

	chain OUTPUT {
		type filter hook output priority filter; policy accept;
		counter packets 2137273 bytes 464511060 jump ufw-before-logging-output
		counter packets 2137273 bytes 464511060 jump ufw-before-output
		counter packets 20841 bytes 1787204 jump ufw-after-output
		counter packets 20841 bytes 1787204 jump ufw-after-logging-output
		counter packets 20841 bytes 1787204 jump ufw-reject-output
		counter packets 20841 bytes 1787204 jump ufw-track-output
	}

	chain FORWARD {
		type filter hook forward priority filter; policy drop;
		counter packets 0 bytes 0 jump ufw-before-logging-forward
		counter packets 0 bytes 0 jump ufw-before-forward
		counter packets 0 bytes 0 jump ufw-after-forward
		counter packets 0 bytes 0 jump ufw-after-logging-forward
		counter packets 0 bytes 0 jump ufw-reject-forward
		counter packets 0 bytes 0 jump ufw-track-forward
	}

	chain ufw-logging-deny {
		ct state invalid limit rate 3/minute burst 10 packets counter packets 88 bytes 24410 return
		limit rate 3/minute burst 10 packets counter packets 0 bytes 0 log prefix "[UFW BLOCK] "
	}

	chain ufw-logging-allow {
		limit rate 3/minute burst 10 packets counter packets 0 bytes 0 log prefix "[UFW ALLOW] "
	}

	chain ufw-skip-to-policy-input {
		counter packets 298 bytes 15128 drop
	}

	chain ufw-skip-to-policy-output {
		counter packets 0 bytes 0 accept
	}

	chain ufw-skip-to-policy-forward {
		counter packets 0 bytes 0 drop
	}

	chain ufw-not-local {
		fib daddr type local counter packets 75562 bytes 7804546 return
		fib daddr type multicast counter packets 3 bytes 160 return
		fib daddr type broadcast counter packets 0 bytes 0 return
		limit rate 3/minute burst 10 packets counter packets 0 bytes 0 jump ufw-logging-deny
		counter packets 0 bytes 0 drop
	}

	chain ufw-user-input {
		ip saddr 172.64.0.0/13 tcp dport 80 counter packets 0 bytes 0 accept
		ip saddr 104.24.0.0/14 tcp dport 80 counter packets 0 bytes 0 accept
		ip saddr 104.16.0.0/13 tcp dport 80 counter packets 1 bytes 60 accept
		ip saddr 162.158.0.0/15 tcp dport 80 counter packets 0 bytes 0 accept
		ip saddr 198.41.128.0/17 tcp dport 80 counter packets 0 bytes 0 accept
		ip saddr 197.234.240.0/22 tcp dport 80 counter packets 0 bytes 0 accept
		ip saddr 188.114.96.0/20 tcp dport 80 counter packets 0 bytes 0 accept
		ip saddr 190.93.240.0/20 tcp dport 80 counter packets 0 bytes 0 accept
		ip saddr 108.162.192.0/18 tcp dport 80 counter packets 0 bytes 0 accept
		ip saddr 141.101.64.0/18 tcp dport 80 counter packets 0 bytes 0 accept
		ip saddr 103.31.4.0/22 tcp dport 80 counter packets 0 bytes 0 accept
		ip saddr 103.22.200.0/22 tcp dport 80 counter packets 0 bytes 0 accept
		ip saddr 103.21.244.0/22 tcp dport 80 counter packets 0 bytes 0 accept
		ip saddr 173.245.48.0/20 tcp dport 80 counter packets 0 bytes 0 accept
		tcp dport 5000 counter packets 4 bytes 232 drop
		tcp dport 22 counter packets 797 bytes 44936 accept
		tcp dport 22  counter packets 0 bytes 0 accept
		udp dport 5000 counter packets 0 bytes 0 accept
		ip protocol udp udp dport { 500, 4500 } counter packets 0 bytes 0 accept
		tcp dport 3000 counter packets 96 bytes 5144 accept
		tcp dport 80 counter packets 23 bytes 1160 drop
		tcp dport 443 counter packets 42 bytes 2280 drop
	}

	chain ufw-user-output {
	}

	chain ufw-user-forward {
	}

	chain ufw-user-logging-input {
	}

	chain ufw-user-logging-output {
	}

	chain ufw-user-logging-forward {
	}

	chain ufw-user-limit {
		limit rate 3/minute burst 5 packets counter packets 0 bytes 0 log prefix "[UFW LIMIT BLOCK] "
		counter packets 0 bytes 0 reject
	}

	chain ufw-user-limit-accept {
		counter packets 0 bytes 0 accept
	}
}
table ip6 filter {
	chain ufw6-before-logging-input {
	}

	chain ufw6-before-logging-output {
	}

	chain ufw6-before-logging-forward {
	}

	chain ufw6-before-input {
		iifname "lo" counter packets 229467 bytes 322858101 accept
		rt type 0 counter packets 0 bytes 0 drop
		ct state related,established counter packets 51187 bytes 657720791 accept
		meta l4proto ipv6-icmp icmpv6 type echo-reply counter packets 0 bytes 0 accept
		ct state invalid counter packets 10 bytes 600 jump ufw6-logging-deny
		ct state invalid counter packets 10 bytes 600 drop
		meta l4proto ipv6-icmp icmpv6 type destination-unreachable counter packets 0 bytes 0 accept
		meta l4proto ipv6-icmp icmpv6 type packet-too-big counter packets 0 bytes 0 accept
		meta l4proto ipv6-icmp icmpv6 type time-exceeded counter packets 0 bytes 0 accept
		meta l4proto ipv6-icmp icmpv6 type parameter-problem counter packets 0 bytes 0 accept
		meta l4proto ipv6-icmp icmpv6 type echo-request counter packets 0 bytes 0 accept
		meta l4proto ipv6-icmp icmpv6 type nd-router-solicit ip6 hoplimit 255 counter packets 0 bytes 0 accept
		meta l4proto ipv6-icmp icmpv6 type nd-router-advert ip6 hoplimit 255 counter packets 0 bytes 0 accept
		meta l4proto ipv6-icmp icmpv6 type nd-neighbor-solicit ip6 hoplimit 255 counter packets 0 bytes 0 accept
		meta l4proto ipv6-icmp icmpv6 type nd-neighbor-advert ip6 hoplimit 255 counter packets 971 bytes 62152 accept
		meta l4proto ipv6-icmp xt match "icmp6" ip6 hoplimit 255 counter packets 0 bytes 0 accept
		meta l4proto ipv6-icmp xt match "icmp6" ip6 hoplimit 255 counter packets 0 bytes 0 accept
		ip6 saddr fe80::/10 meta l4proto ipv6-icmp icmpv6 type mld-listener-query counter packets 0 bytes 0 accept
		ip6 saddr fe80::/10 meta l4proto ipv6-icmp icmpv6 type mld-listener-report counter packets 0 bytes 0 accept
		ip6 saddr fe80::/10 meta l4proto ipv6-icmp icmpv6 type mld-listener-done counter packets 0 bytes 0 accept
		ip6 saddr fe80::/10 meta l4proto ipv6-icmp xt match "icmp6" counter packets 0 bytes 0 accept
		meta l4proto ipv6-icmp xt match "icmp6" ip6 hoplimit 255 counter packets 0 bytes 0 accept
		meta l4proto ipv6-icmp xt match "icmp6" ip6 hoplimit 255 counter packets 0 bytes 0 accept
		ip6 saddr fe80::/10 meta l4proto ipv6-icmp xt match "icmp6" ip6 hoplimit 1 counter packets 0 bytes 0 accept
		ip6 saddr fe80::/10 meta l4proto ipv6-icmp xt match "icmp6" ip6 hoplimit 1 counter packets 0 bytes 0 accept
		ip6 saddr fe80::/10 meta l4proto ipv6-icmp xt match "icmp6" ip6 hoplimit 1 counter packets 0 bytes 0 accept
		meta l4proto ipv6-icmp xt match "icmp6" counter packets 0 bytes 0 accept
		meta l4proto ipv6-icmp xt match "icmp6" counter packets 0 bytes 0 accept
		meta l4proto ipv6-icmp xt match "icmp6" counter packets 0 bytes 0 accept
		meta l4proto ipv6-icmp xt match "icmp6" counter packets 0 bytes 0 accept
		ip6 saddr fe80::/10 ip6 daddr fe80::/10 udp sport 547 udp dport 546 counter packets 0 bytes 0 accept
		ip6 daddr ff02::fb udp dport 5353 counter packets 0 bytes 0 accept
		ip6 daddr ff02::f udp dport 1900 counter packets 0 bytes 0 accept
		counter packets 592 bytes 42986 jump ufw6-user-input
	}

	chain ufw6-before-output {
		oifname "lo" counter packets 229467 bytes 322858101 accept
		rt type 0 counter packets 0 bytes 0 drop
		ct state related,established counter packets 35166 bytes 4662307 accept
		meta l4proto ipv6-icmp icmpv6 type destination-unreachable counter packets 0 bytes 0 accept
		meta l4proto ipv6-icmp icmpv6 type packet-too-big counter packets 0 bytes 0 accept
		meta l4proto ipv6-icmp icmpv6 type time-exceeded counter packets 0 bytes 0 accept
		meta l4proto ipv6-icmp icmpv6 type parameter-problem counter packets 0 bytes 0 accept
		meta l4proto ipv6-icmp icmpv6 type echo-request counter packets 2 bytes 208 accept
		meta l4proto ipv6-icmp icmpv6 type echo-reply counter packets 0 bytes 0 accept
		meta l4proto ipv6-icmp icmpv6 type nd-router-solicit ip6 hoplimit 255 counter packets 288 bytes 14504 accept
		meta l4proto ipv6-icmp icmpv6 type nd-neighbor-advert ip6 hoplimit 255 counter packets 0 bytes 0 accept
		meta l4proto ipv6-icmp icmpv6 type nd-neighbor-solicit ip6 hoplimit 255 counter packets 973 bytes 70056 accept
		meta l4proto ipv6-icmp icmpv6 type nd-router-advert ip6 hoplimit 255 counter packets 0 bytes 0 accept
		meta l4proto ipv6-icmp xt match "icmp6" ip6 hoplimit 255 counter packets 0 bytes 0 accept
		meta l4proto ipv6-icmp xt match "icmp6" ip6 hoplimit 255 counter packets 0 bytes 0 accept
		ip6 saddr fe80::/10 meta l4proto ipv6-icmp icmpv6 type mld-listener-query counter packets 0 bytes 0 accept
		ip6 saddr fe80::/10 meta l4proto ipv6-icmp icmpv6 type mld-listener-report counter packets 0 bytes 0 accept
		ip6 saddr fe80::/10 meta l4proto ipv6-icmp icmpv6 type mld-listener-done counter packets 0 bytes 0 accept
		ip6 saddr fe80::/10 meta l4proto ipv6-icmp xt match "icmp6" counter packets 174 bytes 13344 accept
		meta l4proto ipv6-icmp xt match "icmp6" ip6 hoplimit 255 counter packets 0 bytes 0 accept
		meta l4proto ipv6-icmp xt match "icmp6" ip6 hoplimit 255 counter packets 0 bytes 0 accept
		ip6 saddr fe80::/10 meta l4proto ipv6-icmp xt match "icmp6" ip6 hoplimit 1 counter packets 0 bytes 0 accept
		ip6 saddr fe80::/10 meta l4proto ipv6-icmp xt match "icmp6" ip6 hoplimit 1 counter packets 0 bytes 0 accept
		ip6 saddr fe80::/10 meta l4proto ipv6-icmp xt match "icmp6" ip6 hoplimit 1 counter packets 0 bytes 0 accept
		counter packets 1821 bytes 147169 jump ufw6-user-output
	}

	chain ufw6-before-forward {
		rt type 0 counter packets 0 bytes 0 drop
		ct state related,established counter packets 0 bytes 0 accept
		meta l4proto ipv6-icmp icmpv6 type destination-unreachable counter packets 0 bytes 0 accept
		meta l4proto ipv6-icmp icmpv6 type packet-too-big counter packets 0 bytes 0 accept
		meta l4proto ipv6-icmp icmpv6 type time-exceeded counter packets 0 bytes 0 accept
		meta l4proto ipv6-icmp icmpv6 type parameter-problem counter packets 0 bytes 0 accept
		meta l4proto ipv6-icmp icmpv6 type echo-request counter packets 0 bytes 0 accept
		meta l4proto ipv6-icmp icmpv6 type echo-reply counter packets 0 bytes 0 accept
		counter packets 0 bytes 0 jump ufw6-user-forward
	}

	chain ufw6-after-input {
		udp dport 137 counter packets 0 bytes 0 jump ufw6-skip-to-policy-input
		udp dport 138 counter packets 0 bytes 0 jump ufw6-skip-to-policy-input
		tcp dport 139 counter packets 1 bytes 64 jump ufw6-skip-to-policy-input
		tcp dport 445 counter packets 1 bytes 64 jump ufw6-skip-to-policy-input
		udp dport 546 counter packets 0 bytes 0 jump ufw6-skip-to-policy-input
		udp dport 547 counter packets 0 bytes 0 jump ufw6-skip-to-policy-input
	}

	chain ufw6-after-output {
	}

	chain ufw6-after-forward {
	}

	chain ufw6-after-logging-input {
		limit rate 3/minute burst 10 packets counter packets 16 bytes 1022 log prefix "[UFW BLOCK] "
	}

	chain ufw6-after-logging-output {
	}

	chain ufw6-after-logging-forward {
		limit rate 3/minute burst 10 packets counter packets 0 bytes 0 log prefix "[UFW BLOCK] "
	}

	chain ufw6-reject-input {
	}

	chain ufw6-reject-output {
	}

	chain ufw6-reject-forward {
	}

	chain ufw6-track-input {
	}

	chain ufw6-track-output {
		meta l4proto tcp ct state new counter packets 1634 bytes 130720 accept
		meta l4proto udp ct state new counter packets 174 bytes 15461 accept
	}

	chain ufw6-track-forward {
	}

	chain INPUT {
		type filter hook input priority filter; policy drop;
		counter packets 282227 bytes 980684630 jump ufw6-before-logging-input
		counter packets 282227 bytes 980684630 jump ufw6-before-input
		counter packets 577 bytes 39682 jump ufw6-after-input
		counter packets 575 bytes 39554 jump ufw6-after-logging-input
		counter packets 575 bytes 39554 jump ufw6-reject-input
		counter packets 575 bytes 39554 jump ufw6-track-input
	}

	chain OUTPUT {
		type filter hook output priority filter; policy accept;
		counter packets 267891 bytes 327765689 jump ufw6-before-logging-output
		counter packets 267891 bytes 327765689 jump ufw6-before-output
		counter packets 1821 bytes 147169 jump ufw6-after-output
		counter packets 1821 bytes 147169 jump ufw6-after-logging-output
		counter packets 1821 bytes 147169 jump ufw6-reject-output
		counter packets 1821 bytes 147169 jump ufw6-track-output
	}

	chain FORWARD {
		type filter hook forward priority filter; policy drop;
		counter packets 0 bytes 0 jump ufw6-before-logging-forward
		counter packets 0 bytes 0 jump ufw6-before-forward
		counter packets 0 bytes 0 jump ufw6-after-forward
		counter packets 0 bytes 0 jump ufw6-after-logging-forward
		counter packets 0 bytes 0 jump ufw6-reject-forward
		counter packets 0 bytes 0 jump ufw6-track-forward
	}

	chain ufw6-logging-deny {
		ct state invalid limit rate 3/minute burst 10 packets counter packets 0 bytes 0 return
		limit rate 3/minute burst 10 packets counter packets 0 bytes 0 log prefix "[UFW BLOCK] "
	}

	chain ufw6-logging-allow {
		limit rate 3/minute burst 10 packets counter packets 0 bytes 0 log prefix "[UFW ALLOW] "
	}

	chain ufw6-skip-to-policy-input {
		counter packets 2 bytes 128 drop
	}

	chain ufw6-skip-to-policy-output {
		counter packets 0 bytes 0 accept
	}

	chain ufw6-skip-to-policy-forward {
		counter packets 0 bytes 0 drop
	}

	chain ufw6-user-input {
		ip6 saddr 2a06:98c0::/29 tcp dport 80 counter packets 0 bytes 0 accept
		ip6 saddr 2405:8100::/32 tcp dport 80 counter packets 0 bytes 0 accept
		ip6 saddr 2405:b500::/32 tcp dport 80 counter packets 0 bytes 0 accept
		ip6 saddr 2803:f800::/32 tcp dport 80 counter packets 0 bytes 0 accept
		ip6 saddr 2606:4700::/32 tcp dport 80 counter packets 0 bytes 0 accept
		ip6 saddr 2400:cb00::/32 tcp dport 80 counter packets 0 bytes 0 accept
		tcp dport 5000 counter packets 0 bytes 0 drop
		tcp dport 22 counter packets 0 bytes 0 accept
		tcp dport 22  counter packets 0 bytes 0 accept
		udp dport 5000 counter packets 0 bytes 0 accept
		meta l4proto udp udp dport { 500, 4500 } counter packets 0 bytes 0 accept
		tcp dport 3000 counter packets 0 bytes 0 accept
		tcp dport 80 counter packets 0 bytes 0 drop
		tcp dport 443 counter packets 0 bytes 0 drop
	}

	chain ufw6-user-output {
	}

	chain ufw6-user-forward {
	}

	chain ufw6-user-logging-input {
	}

	chain ufw6-user-logging-output {
	}

	chain ufw6-user-logging-forward {
	}

	chain ufw6-user-limit {
		limit rate 3/minute burst 5 packets counter packets 0 bytes 0 log prefix "[UFW LIMIT BLOCK] "
		counter packets 0 bytes 0 reject
	}

	chain ufw6-user-limit-accept {
		counter packets 0 bytes 0 accept
	}
}
table ip nat {
	chain POSTROUTING {
		type nat hook postrouting priority srcnat; policy accept;
		ip saddr 10.8.0.0/24 oifname "eth0" counter packets 0 bytes 0 masquerade
	}
}
table ip6 nat {
	chain POSTROUTING {
		type nat hook postrouting priority srcnat; policy accept;
		ip6 saddr fd00:0:0:8::/64 oifname "eth0" counter packets 0 bytes 0 masquerade
	}
}

# --- ufw status numbered ---
Status: active

     To                         Action      From
     --                         ------      ----
[ 1] 80/tcp                     ALLOW IN    172.64.0.0/13              # CF-80
[ 2] 80/tcp                     ALLOW IN    104.24.0.0/14              # CF-80
[ 3] 80/tcp                     ALLOW IN    104.16.0.0/13              # CF-80
[ 4] 80/tcp                     ALLOW IN    162.158.0.0/15             # CF-80
[ 5] 80/tcp                     ALLOW IN    198.41.128.0/17            # CF-80
[ 6] 80/tcp                     ALLOW IN    197.234.240.0/22           # CF-80
[ 7] 80/tcp                     ALLOW IN    188.114.96.0/20            # CF-80
[ 8] 80/tcp                     ALLOW IN    190.93.240.0/20            # CF-80
[ 9] 80/tcp                     ALLOW IN    108.162.192.0/18           # CF-80
[10] 80/tcp                     ALLOW IN    141.101.64.0/18            # CF-80
[11] 80/tcp                     ALLOW IN    103.31.4.0/22              # CF-80
[12] 80/tcp                     ALLOW IN    103.22.200.0/22            # CF-80
[13] 80/tcp                     ALLOW IN    103.21.244.0/22            # CF-80
[14] 80/tcp                     ALLOW IN    173.245.48.0/20            # CF-80
[15] 5000/tcp                   DENY IN     Anywhere                  
[16] 22/tcp                     ALLOW IN    Anywhere                   # SSH –¥–æ—Å—Ç—É–ø
[17] OpenSSH                    ALLOW IN    Anywhere                  
[18] 5000/udp                   ALLOW IN    Anywhere                   # TUN gateway UDP
[19] 500,4500/udp               ALLOW IN    Anywhere                   # IPsec VPN (strongSwan)
[20] 3000/tcp                   ALLOW IN    Anywhere                   # Grafana Web UI
[21] 80/tcp                     DENY IN     Anywhere                  
[22] 443/tcp                    DENY IN     Anywhere                  
[23] 80/tcp                     ALLOW IN    2a06:98c0::/29             # CF-80
[24] 80/tcp                     ALLOW IN    2405:8100::/32             # CF-80
[25] 80/tcp                     ALLOW IN    2405:b500::/32             # CF-80
[26] 80/tcp                     ALLOW IN    2803:f800::/32             # CF-80
[27] 80/tcp                     ALLOW IN    2606:4700::/32             # CF-80
[28] 80/tcp                     ALLOW IN    2400:cb00::/32             # CF-80
[29] 5000/tcp (v6)              DENY IN     Anywhere (v6)             
[30] 22/tcp (v6)                ALLOW IN    Anywhere (v6)              # SSH –¥–æ—Å—Ç—É–ø
[31] OpenSSH (v6)               ALLOW IN    Anywhere (v6)             
[32] 5000/udp (v6)              ALLOW IN    Anywhere (v6)              # TUN gateway UDP
[33] 500,4500/udp (v6)          ALLOW IN    Anywhere (v6)              # IPsec VPN (strongSwan)
[34] 3000/tcp (v6)              ALLOW IN    Anywhere (v6)              # Grafana Web UI
[35] 80/tcp (v6)                DENY IN     Anywhere (v6)             
[36] 443/tcp (v6)               DENY IN     Anywhere (v6)             


# --- listen 80/5001/5000 ---
LISTEN 0      1024                          127.0.0.1:5001       0.0.0.0:*    users:(("websocat",pid=297748,fd=6))                                                 
LISTEN 0      128                             0.0.0.0:5000       0.0.0.0:*    users:(("python",pid=329125,fd=5))                                                   
LISTEN 0      511                             0.0.0.0:80         0.0.0.0:*    users:(("nginx",pid=299623,fd=5),("nginx",pid=299622,fd=5),("nginx",pid=288527,fd=5))
LISTEN 0      511                                [::]:80            [::]:*    users:(("nginx",pid=299623,fd=6),("nginx",pid=299622,fd=6),("nginx",pid=288527,fd=6))

# --- websocat --version ---
websocat 1.13.0

# --- /var/log/ufw.log tail ---
2025-08-10T15:13:00.138530+00:00 ubuntu-4gb-hel1-2 kernel: [UFW BLOCK] IN=eth0 OUT= MAC=96:00:04:64:d8:5e:d2:74:7f:6e:37:e3:08:00 SRC=194.180.49.130 DST=46.62.133.47 LEN=40 TOS=0x00 PREC=0x40 TTL=245 ID=27888 PROTO=TCP SPT=55799 DPT=8730 WINDOW=1024 RES=0x00 SYN URGP=0 
2025-08-10T15:13:05.416933+00:00 ubuntu-4gb-hel1-2 kernel: [UFW BLOCK] IN=eth0 OUT= MAC=96:00:04:64:d8:5e:d2:74:7f:6e:37:e3:08:00 SRC=35.203.211.93 DST=46.62.133.47 LEN=44 TOS=0x00 PREC=0x00 TTL=248 ID=54321 PROTO=TCP SPT=51846 DPT=19998 WINDOW=65535 RES=0x00 SYN URGP=0 
2025-08-10T15:13:32.578099+00:00 ubuntu-4gb-hel1-2 kernel: [UFW BLOCK] IN=eth0 OUT= MAC=96:00:04:64:d8:5e:d2:74:7f:6e:37:e3:08:00 SRC=205.210.31.194 DST=46.62.133.47 LEN=44 TOS=0x00 PREC=0x00 TTL=248 ID=6571 PROTO=TCP SPT=52417 DPT=23 WINDOW=1024 RES=0x00 SYN URGP=0 
2025-08-10T15:13:38.493077+00:00 ubuntu-4gb-hel1-2 kernel: [UFW BLOCK] IN=eth0 OUT= MAC=96:00:04:64:d8:5e:d2:74:7f:6e:37:e3:08:00 SRC=94.102.49.193 DST=46.62.133.47 LEN=44 TOS=0x10 PREC=0x00 TTL=118 ID=57555 PROTO=TCP SPT=23320 DPT=8083 WINDOW=23475 RES=0x00 SYN URGP=0 
2025-08-10T15:14:06.193559+00:00 ubuntu-4gb-hel1-2 kernel: [UFW BLOCK] IN=eth0 OUT= MAC=96:00:04:64:d8:5e:d2:74:7f:6e:37:e3:08:00 SRC=147.185.133.222 DST=46.62.133.47 LEN=44 TOS=0x00 PREC=0x00 TTL=248 ID=54321 PROTO=TCP SPT=53030 DPT=23524 WINDOW=65535 RES=0x00 SYN URGP=0 
2025-08-10T15:14:22.604119+00:00 ubuntu-4gb-hel1-2 kernel: [UFW BLOCK] IN=eth0 OUT= MAC=96:00:04:64:d8:5e:d2:74:7f:6e:37:e3:08:00 SRC=3.85.229.132 DST=46.62.133.47 LEN=40 TOS=0x00 PREC=0x00 TTL=240 ID=54321 PROTO=TCP SPT=54055 DPT=530 WINDOW=65535 RES=0x00 SYN URGP=0 
2025-08-10T15:14:37.548669+00:00 ubuntu-4gb-hel1-2 kernel: [UFW BLOCK] IN=eth0 OUT= MAC=96:00:04:64:d8:5e:d2:74:7f:6e:37:e3:08:00 SRC=204.76.203.193 DST=46.62.133.47 LEN=40 TOS=0x00 PREC=0x00 TTL=245 ID=54321 PROTO=TCP SPT=41157 DPT=1234 WINDOW=65535 RES=0x00 SYN URGP=0 
2025-08-10T15:14:57.384300+00:00 ubuntu-4gb-hel1-2 kernel: [UFW BLOCK] IN=eth0 OUT= MAC=96:00:04:64:d8:5e:d2:74:7f:6e:37:e3:08:00 SRC=48.216.243.151 DST=46.62.133.47 LEN=40 TOS=0x00 PREC=0x00 TTL=237 ID=54321 PROTO=TCP SPT=54937 DPT=7443 WINDOW=65535 RES=0x00 SYN URGP=0 
2025-08-10T15:15:23.454665+00:00 ubuntu-4gb-hel1-2 kernel: [UFW BLOCK] IN=eth0 OUT= MAC=96:00:04:64:d8:5e:d2:74:7f:6e:37:e3:08:00 SRC=162.216.150.229 DST=46.62.133.47 LEN=44 TOS=0x00 PREC=0x00 TTL=248 ID=54321 PROTO=TCP SPT=50758 DPT=9321 WINDOW=65535 RES=0x00 SYN URGP=0 
2025-08-10T15:15:58.697918+00:00 ubuntu-4gb-hel1-2 kernel: [UFW BLOCK] IN=eth0 OUT= MAC=96:00:04:64:d8:5e:d2:74:7f:6e:37:e3:08:00 SRC=162.216.149.143 DST=46.62.133.47 LEN=44 TOS=0x00 PREC=0x00 TTL=248 ID=54321 PROTO=TCP SPT=50555 DPT=9479 WINDOW=65535 RES=0x00 SYN URGP=0 
2025-08-10T15:16:07.404287+00:00 ubuntu-4gb-hel1-2 kernel: [UFW BLOCK] IN=eth0 OUT= MAC=96:00:04:64:d8:5e:d2:74:7f:6e:37:e3:08:00 SRC=45.91.171.169 DST=46.62.133.47 LEN=40 TOS=0x08 PREC=0x20 TTL=245 ID=54321 PROTO=TCP SPT=60278 DPT=8881 WINDOW=65535 RES=0x00 SYN URGP=0 
2025-08-10T15:16:20.083370+00:00 ubuntu-4gb-hel1-2 kernel: [UFW BLOCK] IN=eth0 OUT= MAC=96:00:04:64:d8:5e:d2:74:7f:6e:37:e3:08:00 SRC=49.115.217.27 DST=46.62.133.47 LEN=60 TOS=0x00 PREC=0x00 TTL=47 ID=37631 DF PROTO=TCP SPT=36818 DPT=6379 WINDOW=29200 RES=0x00 SYN URGP=0 
2025-08-10T15:16:51.579776+00:00 ubuntu-4gb-hel1-2 kernel: [UFW BLOCK] IN=eth0 OUT= MAC=96:00:04:64:d8:5e:d2:74:7f:6e:37:e3:08:00 SRC=194.180.49.130 DST=46.62.133.47 LEN=40 TOS=0x00 PREC=0x40 TTL=245 ID=50680 PROTO=TCP SPT=55799 DPT=8191 WINDOW=1024 RES=0x00 SYN URGP=0 
2025-08-10T15:17:07.619711+00:00 ubuntu-4gb-hel1-2 kernel: [UFW BLOCK] IN=eth0 OUT= MAC=96:00:04:64:d8:5e:d2:74:7f:6e:37:e3:08:00 SRC=45.74.16.119 DST=46.62.133.47 LEN=40 TOS=0x00 PREC=0x00 TTL=247 ID=3034 PROTO=TCP SPT=60001 DPT=8026 WINDOW=1024 RES=0x00 SYN URGP=0 
2025-08-10T15:17:25.842736+00:00 ubuntu-4gb-hel1-2 kernel: [UFW BLOCK] IN=eth0 OUT= MAC=96:00:04:64:d8:5e:d2:74:7f:6e:37:e3:08:00 SRC=206.168.34.145 DST=46.62.133.47 LEN=60 TOS=0x00 PREC=0x00 TTL=50 ID=24049 PROTO=TCP SPT=6555 DPT=37594 WINDOW=42340 RES=0x00 SYN URGP=0 
2025-08-10T15:17:38.414174+00:00 ubuntu-4gb-hel1-2 kernel: [UFW BLOCK] IN=eth0 OUT= MAC=96:00:04:64:d8:5e:d2:74:7f:6e:37:e3:08:00 SRC=82.147.84.237 DST=46.62.133.47 LEN=40 TOS=0x00 PREC=0x00 TTL=246 ID=54321 PROTO=TCP SPT=43440 DPT=1194 WINDOW=65535 RES=0x00 SYN URGP=0 
2025-08-10T15:18:01.661820+00:00 ubuntu-4gb-hel1-2 kernel: [UFW BLOCK] IN=eth0 OUT= MAC=96:00:04:64:d8:5e:d2:74:7f:6e:37:e3:08:00 SRC=194.180.49.130 DST=46.62.133.47 LEN=40 TOS=0x00 PREC=0x40 TTL=245 ID=23342 PROTO=TCP SPT=55799 DPT=8471 WINDOW=1024 RES=0x00 SYN URGP=0 
2025-08-10T15:18:18.255513+00:00 ubuntu-4gb-hel1-2 kernel: [UFW BLOCK] IN=eth0 OUT= MAC=96:00:04:64:d8:5e:d2:74:7f:6e:37:e3:08:00 SRC=45.91.171.169 DST=46.62.133.47 LEN=40 TOS=0x08 PREC=0x20 TTL=245 ID=54321 PROTO=TCP SPT=42626 DPT=8881 WINDOW=65535 RES=0x00 SYN URGP=0 
2025-08-10T15:19:25.048202+00:00 ubuntu-4gb-hel1-2 kernel: [UFW BLOCK] IN=eth0 OUT= MAC=96:00:04:64:d8:5e:d2:74:7f:6e:37:e3:08:00 SRC=83.222.190.246 DST=46.62.133.47 LEN=44 TOS=0x00 PREC=0x00 TTL=243 ID=31517 PROTO=TCP SPT=42128 DPT=9999 WINDOW=1025 RES=0x00 SYN URGP=0 
2025-08-10T15:19:40.786941+00:00 ubuntu-4gb-hel1-2 kernel: [UFW BLOCK] IN=eth0 OUT= MAC=96:00:04:64:d8:5e:d2:74:7f:6e:37:e3:08:00 SRC=194.180.49.130 DST=46.62.133.47 LEN=40 TOS=0x00 PREC=0x40 TTL=245 ID=63269 PROTO=TCP SPT=55799 DPT=8870 WINDOW=1024 RES=0x00 SYN URGP=0 
2025-08-10T15:19:53.784334+00:00 ubuntu-4gb-hel1-2 kernel: [UFW BLOCK] IN=eth0 OUT= MAC=96:00:04:64:d8:5e:d2:74:7f:6e:37:e3:08:00 SRC=162.216.149.213 DST=46.62.133.47 LEN=44 TOS=0x00 PREC=0x00 TTL=248 ID=54321 PROTO=TCP SPT=54088 DPT=50000 WINDOW=65535 RES=0x00 SYN URGP=0 
2025-08-10T15:20:44.430845+00:00 ubuntu-4gb-hel1-2 kernel: [UFW BLOCK] IN=eth0 OUT= MAC=96:00:04:64:d8:5e:d2:74:7f:6e:37:e3:08:00 SRC=123.136.6.107 DST=46.62.133.47 LEN=40 TOS=0x00 PREC=0x00 TTL=245 ID=6319 PROTO=TCP SPT=30163 DPT=30163 WINDOW=1024 RES=0x00 SYN URGP=0 
2025-08-10T15:20:55.757854+00:00 ubuntu-4gb-hel1-2 kernel: [UFW BLOCK] IN=eth0 OUT= MAC=96:00:04:64:d8:5e:d2:74:7f:6e:37:e3:08:00 SRC=83.222.190.242 DST=46.62.133.47 LEN=44 TOS=0x00 PREC=0x00 TTL=243 ID=31860 PROTO=TCP SPT=44183 DPT=33939 WINDOW=1025 RES=0x00 SYN URGP=0 
2025-08-10T15:21:20.813256+00:00 ubuntu-4gb-hel1-2 kernel: [UFW BLOCK] IN=eth0 OUT= MAC=96:00:04:64:d8:5e:d2:74:7f:6e:37:e3:08:00 SRC=35.203.211.23 DST=46.62.133.47 LEN=44 TOS=0x00 PREC=0x00 TTL=248 ID=54321 PROTO=TCP SPT=53493 DPT=47984 WINDOW=65535 RES=0x00 SYN URGP=0 
2025-08-10T15:21:51.469882+00:00 ubuntu-4gb-hel1-2 kernel: [UFW BLOCK] IN=eth0 OUT= MAC=96:00:04:64:d8:5e:d2:74:7f:6e:37:e3:08:00 SRC=45.142.154.86 DST=46.62.133.47 LEN=44 TOS=0x00 PREC=0x00 TTL=235 ID=46201 PROTO=TCP SPT=58914 DPT=6467 WINDOW=1024 RES=0x00 SYN URGP=0 
2025-08-10T15:21:53.556074+00:00 ubuntu-4gb-hel1-2 kernel: [UFW BLOCK] IN=eth0 OUT= MAC=96:00:04:64:d8:5e:d2:74:7f:6e:37:e3:08:00 SRC=194.180.49.130 DST=46.62.133.47 LEN=40 TOS=0x00 PREC=0x40 TTL=245 ID=26269 PROTO=TCP SPT=55799 DPT=8105 WINDOW=1024 RES=0x00 SYN URGP=0 
2025-08-10T15:21:56.025085+00:00 ubuntu-4gb-hel1-2 kernel: [UFW BLOCK] IN=eth0 OUT= MAC=96:00:04:64:d8:5e:d2:74:7f:6e:37:e3:08:00 SRC=83.222.190.66 DST=46.62.133.47 LEN=52 TOS=0x00 PREC=0x00 TTL=54 ID=15025 PROTO=TCP SPT=58295 DPT=3389 WINDOW=65535 RES=0x00 SYN URGP=0 
2025-08-10T15:22:02.777060+00:00 ubuntu-4gb-hel1-2 kernel: [UFW BLOCK] IN=eth0 OUT= MAC=96:00:04:64:d8:5e:d2:74:7f:6e:37:e3:08:00 SRC=65.49.1.149 DST=46.62.133.47 LEN=40 TOS=0x00 PREC=0x00 TTL=239 ID=54321 PROTO=TCP SPT=47580 DPT=2600 WINDOW=65535 RES=0x00 SYN URGP=0 
2025-08-10T15:22:06.826821+00:00 ubuntu-4gb-hel1-2 kernel: [UFW BLOCK] IN=eth0 OUT= MAC=96:00:04:64:d8:5e:d2:74:7f:6e:37:e3:08:00 SRC=103.102.230.4 DST=46.62.133.47 LEN=40 TOS=0x00 PREC=0x00 TTL=236 ID=54321 PROTO=TCP SPT=41380 DPT=8728 WINDOW=65535 RES=0x00 SYN URGP=0 
2025-08-10T15:22:22.942480+00:00 ubuntu-4gb-hel1-2 kernel: [UFW BLOCK] IN=eth0 OUT= MAC=96:00:04:64:d8:5e:d2:74:7f:6e:37:e3:08:00 SRC=184.105.247.214 DST=46.62.133.47 LEN=40 TOS=0x00 PREC=0x00 TTL=239 ID=54321 PROTO=TCP SPT=48886 DPT=7047 WINDOW=65535 RES=0x00 SYN URGP=0 
2025-08-10T15:22:44.172058+00:00 ubuntu-4gb-hel1-2 kernel: [UFW BLOCK] IN=eth0 OUT= MAC=96:00:04:64:d8:5e:d2:74:7f:6e:37:e3:08:00 SRC=162.216.150.16 DST=46.62.133.47 LEN=44 TOS=0x00 PREC=0x00 TTL=248 ID=54321 PROTO=TCP SPT=50188 DPT=13390 WINDOW=65535 RES=0x00 SYN URGP=0 
2025-08-10T15:23:08.163303+00:00 ubuntu-4gb-hel1-2 kernel: [UFW BLOCK] IN=eth0 OUT= MAC=96:00:04:64:d8:5e:d2:74:7f:6e:37:e3:08:00 SRC=162.216.150.40 DST=46.62.133.47 LEN=44 TOS=0x00 PREC=0x00 TTL=248 ID=54321 PROTO=TCP SPT=52392 DPT=8037 WINDOW=65535 RES=0x00 SYN URGP=0 
2025-08-10T15:23:37.133099+00:00 ubuntu-4gb-hel1-2 kernel: [UFW BLOCK] IN=eth0 OUT= MAC=96:00:04:64:d8:5e:d2:74:7f:6e:37:e3:08:00 SRC=47.102.184.247 DST=46.62.133.47 LEN=40 TOS=0x00 PREC=0x00 TTL=43 ID=62329 PROTO=TCP SPT=48583 DPT=23 WINDOW=64424 RES=0x00 SYN URGP=0 
2025-08-10T15:23:37.445473+00:00 ubuntu-4gb-hel1-2 kernel: [UFW BLOCK] IN=eth0 OUT= MAC=96:00:04:64:d8:5e:d2:74:7f:6e:37:e3:08:00 SRC=87.121.84.128 DST=46.62.133.47 LEN=67 TOS=0x00 PREC=0x00 TTL=244 ID=54321 PROTO=UDP SPT=26429 DPT=389 LEN=47 
2025-08-10T15:23:58.958973+00:00 ubuntu-4gb-hel1-2 kernel: [UFW BLOCK] IN=eth0 OUT= MAC=96:00:04:64:d8:5e:d2:74:7f:6e:37:e3:08:00 SRC=64.62.156.207 DST=46.62.133.47 LEN=40 TOS=0x00 PREC=0x00 TTL=239 ID=54321 PROTO=TCP SPT=58587 DPT=2404 WINDOW=65535 RES=0x00 SYN URGP=0 
2025-08-10T15:24:17.228834+00:00 ubuntu-4gb-hel1-2 kernel: [UFW BLOCK] IN=eth0 OUT= MAC=96:00:04:64:d8:5e:d2:74:7f:6e:37:e3:08:00 SRC=89.248.163.240 DST=46.62.133.47 LEN=40 TOS=0x00 PREC=0x00 TTL=245 ID=1555 PROTO=TCP SPT=52731 DPT=26443 WINDOW=1024 RES=0x00 SYN URGP=0 
2025-08-10T15:24:42.850823+00:00 ubuntu-4gb-hel1-2 kernel: [UFW BLOCK] IN=eth0 OUT= MAC=96:00:04:64:d8:5e:d2:74:7f:6e:37:e3:08:00 SRC=196.251.91.88 DST=46.62.133.47 LEN=44 TOS=0x00 PREC=0x00 TTL=244 ID=31010 PROTO=TCP SPT=59159 DPT=3306 WINDOW=1025 RES=0x00 SYN URGP=0 
2025-08-10T15:25:09.617490+00:00 ubuntu-4gb-hel1-2 kernel: [UFW BLOCK] IN=eth0 OUT= MAC=96:00:04:64:d8:5e:d2:74:7f:6e:37:e3:08:00 SRC=86.104.46.118 DST=46.62.133.47 LEN=7528 TOS=0x00 PREC=0x00 TTL=49 ID=7861 PROTO=UDP SPT=49272 DPT=25095 LEN=7508 
2025-08-10T15:25:17.835097+00:00 ubuntu-4gb-hel1-2 kernel: [UFW BLOCK] IN=eth0 OUT= MAC=96:00:04:64:d8:5e:d2:74:7f:6e:37:e3:08:00 SRC=194.180.49.130 DST=46.62.133.47 LEN=40 TOS=0x00 PREC=0x40 TTL=245 ID=62737 PROTO=TCP SPT=55799 DPT=8705 WINDOW=1024 RES=0x00 SYN URGP=0 
2025-08-10T15:25:50.180706+00:00 ubuntu-4gb-hel1-2 kernel: [UFW BLOCK] IN=eth0 OUT= MAC=96:00:04:64:d8:5e:d2:74:7f:6e:37:e3:08:00 SRC=35.203.211.101 DST=46.62.133.47 LEN=44 TOS=0x00 PREC=0x00 TTL=248 ID=54321 PROTO=TCP SPT=53433 DPT=9454 WINDOW=65535 RES=0x00 SYN URGP=0 
2025-08-10T15:26:22.309837+00:00 ubuntu-4gb-hel1-2 kernel: [UFW BLOCK] IN=eth0 OUT= MAC=96:00:04:64:d8:5e:d2:74:7f:6e:37:e3:08:00 SRC=114.80.32.147 DST=46.62.133.47 LEN=60 TOS=0x00 PREC=0x00 TTL=47 ID=36969 DF PROTO=TCP SPT=55366 DPT=6379 WINDOW=29200 RES=0x00 SYN URGP=0 
2025-08-10T15:26:29.897039+00:00 ubuntu-4gb-hel1-2 kernel: [UFW BLOCK] IN=eth0 OUT= MAC=96:00:04:64:d8:5e:d2:74:7f:6e:37:e3:08:00 SRC=35.203.210.157 DST=46.62.133.47 LEN=44 TOS=0x00 PREC=0x00 TTL=248 ID=44694 PROTO=TCP SPT=57244 DPT=34453 WINDOW=1024 RES=0x00 SYN URGP=0 
2025-08-10T15:26:38.372062+00:00 ubuntu-4gb-hel1-2 kernel: [UFW BLOCK] IN=eth0 OUT= MAC=96:00:04:64:d8:5e:d2:74:7f:6e:37:e3:08:00 SRC=46.8.112.18 DST=46.62.133.47 LEN=44 TOS=0x00 PREC=0x00 TTL=242 ID=13080 PROTO=TCP SPT=58914 DPT=5610 WINDOW=1024 RES=0x00 SYN URGP=0 
2025-08-10T15:27:27.040641+00:00 ubuntu-4gb-hel1-2 kernel: [UFW BLOCK] IN=eth0 OUT= MAC=96:00:04:64:d8:5e:d2:74:7f:6e:37:e3:08:00 SRC=165.227.222.12 DST=46.62.133.47 LEN=44 TOS=0x00 PREC=0x00 TTL=238 ID=1086 PROTO=TCP SPT=61006 DPT=10000 WINDOW=1025 RES=0x00 SYN URGP=0 
2025-08-10T15:27:42.925413+00:00 ubuntu-4gb-hel1-2 kernel: [UFW BLOCK] IN=eth0 OUT= MAC=96:00:04:64:d8:5e:d2:74:7f:6e:37:e3:08:00 SRC=196.251.69.156 DST=46.62.133.47 LEN=40 TOS=0x00 PREC=0x00 TTL=244 ID=6925 PROTO=TCP SPT=41916 DPT=49301 WINDOW=1024 RES=0x00 SYN URGP=0 
2025-08-10T15:27:45.718136+00:00 ubuntu-4gb-hel1-2 kernel: [UFW BLOCK] IN=eth0 OUT= MAC=96:00:04:64:d8:5e:d2:74:7f:6e:37:e3:08:00 SRC=35.203.211.162 DST=46.62.133.47 LEN=44 TOS=0x00 PREC=0x00 TTL=248 ID=54321 PROTO=TCP SPT=54427 DPT=28078 WINDOW=65535 RES=0x00 SYN URGP=0 
2025-08-10T15:28:11.714758+00:00 ubuntu-4gb-hel1-2 kernel: [UFW BLOCK] IN=eth0 OUT= MAC=96:00:04:64:d8:5e:d2:74:7f:6e:37:e3:08:00 SRC=46.8.112.2 DST=46.62.133.47 LEN=44 TOS=0x00 PREC=0x00 TTL=242 ID=43942 PROTO=TCP SPT=58914 DPT=2239 WINDOW=1024 RES=0x00 SYN URGP=0 
2025-08-10T15:28:30.127527+00:00 ubuntu-4gb-hel1-2 kernel: [UFW BLOCK] IN=eth0 OUT= MAC=96:00:04:64:d8:5e:d2:74:7f:6e:37:e3:08:00 SRC=83.222.191.130 DST=46.62.133.47 LEN=40 TOS=0x00 PREC=0x00 TTL=243 ID=33354 PROTO=TCP SPT=50782 DPT=5367 WINDOW=1024 RES=0x00 SYN URGP=0 
2025-08-10T15:29:14.847664+00:00 ubuntu-4gb-hel1-2 kernel: [UFW BLOCK] IN=eth0 OUT= MAC=96:00:04:64:d8:5e:d2:74:7f:6e:37:e3:08:00 SRC=194.180.49.130 DST=46.62.133.47 LEN=40 TOS=0x00 PREC=0x40 TTL=245 ID=20942 PROTO=TCP SPT=55799 DPT=8904 WINDOW=1024 RES=0x00 SYN URGP=0 
2025-08-10T15:29:31.440696+00:00 ubuntu-4gb-hel1-2 kernel: [UFW BLOCK] IN=eth0 OUT= MAC=96:00:04:64:d8:5e:d2:74:7f:6e:37:e3:08:00 SRC=194.180.49.130 DST=46.62.133.47 LEN=40 TOS=0x00 PREC=0x40 TTL=245 ID=41162 PROTO=TCP SPT=55799 DPT=8615 WINDOW=1024 RES=0x00 SYN URGP=0 
2025-08-10T15:29:37.466496+00:00 ubuntu-4gb-hel1-2 kernel: [UFW BLOCK] IN=eth0 OUT= MAC=96:00:04:64:d8:5e:d2:74:7f:6e:37:e3:08:00 SRC=194.180.49.130 DST=46.62.133.47 LEN=40 TOS=0x00 PREC=0x40 TTL=245 ID=51429 PROTO=TCP SPT=55799 DPT=8225 WINDOW=1024 RES=0x00 SYN URGP=0 
2025-08-10T15:29:43.773437+00:00 ubuntu-4gb-hel1-2 kernel: [UFW BLOCK] IN=eth0 OUT= MAC=96:00:04:64:d8:5e:d2:74:7f:6e:37:e3:08:00 SRC=89.248.163.240 DST=46.62.133.47 LEN=40 TOS=0x00 PREC=0x00 TTL=245 ID=23282 PROTO=TCP SPT=52731 DPT=7443 WINDOW=1024 RES=0x00 SYN URGP=0 
2025-08-10T15:30:11.531311+00:00 ubuntu-4gb-hel1-2 kernel: [UFW BLOCK] IN=eth0 OUT= MAC=96:00:04:64:d8:5e:d2:74:7f:6e:37:e3:08:00 SRC=115.231.78.14 DST=46.62.133.47 LEN=44 TOS=0x00 PREC=0x00 TTL=109 ID=0 PROTO=TCP SPT=30486 DPT=873 WINDOW=29200 RES=0x00 SYN URGP=0 
2025-08-10T15:30:26.703393+00:00 ubuntu-4gb-hel1-2 kernel: [UFW BLOCK] IN=eth0 OUT= MAC=96:00:04:64:d8:5e:d2:74:7f:6e:37:e3:08:00 SRC=59.182.85.158 DST=46.62.133.47 LEN=60 TOS=0x00 PREC=0x00 TTL=44 ID=5864 DF PROTO=TCP SPT=55141 DPT=7574 WINDOW=5808 RES=0x00 SYN URGP=0 
2025-08-10T15:30:37.538228+00:00 ubuntu-4gb-hel1-2 kernel: [UFW BLOCK] IN=eth0 OUT= MAC=96:00:04:64:d8:5e:d2:74:7f:6e:37:e3:08:00 SRC=194.180.49.130 DST=46.62.133.47 LEN=40 TOS=0x00 PREC=0x40 TTL=245 ID=8238 PROTO=TCP SPT=55799 DPT=8628 WINDOW=1024 RES=0x00 SYN URGP=0 
2025-08-10T15:31:11.988201+00:00 ubuntu-4gb-hel1-2 kernel: [UFW BLOCK] IN=eth0 OUT= MAC=96:00:04:64:d8:5e:d2:74:7f:6e:37:e3:08:00 SRC=59.98.206.92 DST=46.62.133.47 LEN=60 TOS=0x00 PREC=0x00 TTL=49 ID=10725 DF PROTO=TCP SPT=42279 DPT=8080 WINDOW=5808 RES=0x00 SYN URGP=0 
2025-08-10T15:31:21.016671+00:00 ubuntu-4gb-hel1-2 kernel: [UFW BLOCK] IN=eth0 OUT= MAC=96:00:04:64:d8:5e:d2:74:7f:6e:37:e3:08:00 SRC=59.98.206.92 DST=46.62.133.47 LEN=60 TOS=0x00 PREC=0x00 TTL=49 ID=10727 DF PROTO=TCP SPT=42279 DPT=8080 WINDOW=5808 RES=0x00 SYN URGP=0 
2025-08-10T15:31:39.955778+00:00 ubuntu-4gb-hel1-2 kernel: [UFW BLOCK] IN=eth0 OUT= MAC=96:00:04:64:d8:5e:d2:74:7f:6e:37:e3:08:00 SRC=45.140.17.26 DST=46.62.133.47 LEN=52 TOS=0x02 PREC=0x00 TTL=117 ID=17298 DF PROTO=TCP SPT=37317 DPT=25 WINDOW=64240 RES=0x00 CWR ECE SYN URGP=0 
2025-08-10T15:31:59.992227+00:00 ubuntu-4gb-hel1-2 kernel: [UFW BLOCK] IN=eth0 OUT= MAC=96:00:04:64:d8:5e:d2:74:7f:6e:37:e3:08:00 SRC=45.140.17.26 DST=46.62.133.47 LEN=52 TOS=0x00 PREC=0x00 TTL=117 ID=17305 DF PROTO=TCP SPT=2038 DPT=3389 WINDOW=64240 RES=0x00 SYN URGP=0 
2025-08-10T15:32:21.254348+00:00 ubuntu-4gb-hel1-2 kernel: [UFW BLOCK] IN=eth0 OUT= MAC=96:00:04:64:d8:5e:d2:74:7f:6e:37:e3:08:00 SRC=35.203.210.200 DST=46.62.133.47 LEN=44 TOS=0x00 PREC=0x00 TTL=248 ID=54321 PROTO=TCP SPT=53967 DPT=45061 WINDOW=65535 RES=0x00 SYN URGP=0 
2025-08-10T15:32:43.331546+00:00 ubuntu-4gb-hel1-2 kernel: [UFW BLOCK] IN=eth0 OUT= MAC=96:00:04:64:d8:5e:d2:74:7f:6e:37:e3:08:00 SRC=165.154.59.118 DST=46.62.133.47 LEN=44 TOS=0x00 PREC=0x00 TTL=37 ID=0 DF PROTO=TCP SPT=49539 DPT=59100 WINDOW=1024 RES=0x00 SYN URGP=0 
2025-08-10T15:33:20.560495+00:00 ubuntu-4gb-hel1-2 kernel: [UFW BLOCK] IN=eth0 OUT= MAC=96:00:04:64:d8:5e:d2:74:7f:6e:37:e3:08:00 SRC=185.91.127.107 DST=46.62.133.47 LEN=52 TOS=0x00 PREC=0x00 TTL=56 ID=36623 PROTO=TCP SPT=443 DPT=1085 WINDOW=65535 RES=0x00 SYN URGP=0 
2025-08-10T15:33:25.588578+00:00 ubuntu-4gb-hel1-2 kernel: [UFW BLOCK] IN=eth0 OUT= MAC=96:00:04:64:d8:5e:d2:74:7f:6e:37:e3:08:00 SRC=8.130.67.219 DST=46.62.133.47 LEN=40 TOS=0x00 PREC=0xA0 TTL=237 ID=31866 PROTO=TCP SPT=44158 DPT=2375 WINDOW=1024 RES=0x00 SYN URGP=0 
2025-08-10T15:34:13.098098+00:00 ubuntu-4gb-hel1-2 kernel: [UFW BLOCK] IN=eth0 OUT= MAC=96:00:04:64:d8:5e:d2:74:7f:6e:37:e3:08:00 SRC=79.124.62.126 DST=46.62.133.47 LEN=40 TOS=0x00 PREC=0x00 TTL=243 ID=24157 PROTO=TCP SPT=57599 DPT=135 WINDOW=1024 RES=0x00 SYN URGP=0 
2025-08-10T15:34:24.187754+00:00 ubuntu-4gb-hel1-2 kernel: [UFW BLOCK] IN=eth0 OUT= MAC=96:00:04:64:d8:5e:d2:74:7f:6e:37:e3:08:00 SRC=91.148.190.150 DST=46.62.133.47 LEN=44 TOS=0x00 PREC=0x00 TTL=243 ID=60086 PROTO=TCP SPT=46893 DPT=6485 WINDOW=1025 RES=0x00 SYN URGP=0 
2025-08-10T15:34:34.336223+00:00 ubuntu-4gb-hel1-2 kernel: [UFW BLOCK] IN=eth0 OUT= MAC=96:00:04:64:d8:5e:d2:74:7f:6e:37:e3:08:00 SRC=152.32.245.44 DST=46.62.133.47 LEN=44 TOS=0x00 PREC=0x60 TTL=45 ID=0 DF PROTO=TCP SPT=49539 DPT=1762 WINDOW=1024 RES=0x00 SYN URGP=0 
2025-08-10T15:34:44.473787+00:00 ubuntu-4gb-hel1-2 kernel: [UFW BLOCK] IN=eth0 OUT= MAC=96:00:04:64:d8:5e:d2:74:7f:6e:37:e3:08:00 SRC=8.211.52.121 DST=46.62.133.47 LEN=52 TOS=0x14 PREC=0x00 TTL=52 ID=30481 DF PROTO=TCP SPT=31505 DPT=8969 WINDOW=61690 RES=0x00 SYN URGP=0 
2025-08-10T15:35:11.519243+00:00 ubuntu-4gb-hel1-2 kernel: [UFW BLOCK] IN=eth0 OUT= MAC=96:00:04:64:d8:5e:d2:74:7f:6e:37:e3:08:00 SRC=193.163.125.151 DST=46.62.133.47 LEN=44 TOS=0x00 PREC=0x00 TTL=244 ID=52352 PROTO=TCP SPT=41519 DPT=4446 WINDOW=14600 RES=0x00 SYN URGP=0 
2025-08-10T15:35:27.205997+00:00 ubuntu-4gb-hel1-2 kernel: [UFW BLOCK] IN=eth0 OUT= MAC=96:00:04:64:d8:5e:d2:74:7f:6e:37:e3:08:00 SRC=83.222.190.246 DST=46.62.133.47 LEN=44 TOS=0x00 PREC=0x00 TTL=243 ID=43292 PROTO=TCP SPT=42144 DPT=26000 WINDOW=1025 RES=0x00 SYN URGP=0 
2025-08-10T15:36:00.858106+00:00 ubuntu-4gb-hel1-2 kernel: [UFW BLOCK] IN=eth0 OUT= MAC=96:00:04:64:d8:5e:d2:74:7f:6e:37:e3:08:00 SRC=86.104.46.118 DST=46.62.133.47 LEN=7528 TOS=0x00 PREC=0x00 TTL=49 ID=36442 PROTO=UDP SPT=49272 DPT=25094 LEN=7508 
2025-08-10T15:36:15.668774+00:00 ubuntu-4gb-hel1-2 kernel: [UFW BLOCK] IN=eth0 OUT= MAC=96:00:04:64:d8:5e:d2:74:7f:6e:37:e3:08:00 SRC=35.203.211.50 DST=46.62.133.47 LEN=44 TOS=0x00 PREC=0x00 TTL=248 ID=54321 PROTO=TCP SPT=49303 DPT=40007 WINDOW=65535 RES=0x00 SYN URGP=0 
2025-08-10T15:36:31.302497+00:00 ubuntu-4gb-hel1-2 kernel: [UFW BLOCK] IN=eth0 OUT= MAC=96:00:04:64:d8:5e:d2:74:7f:6e:37:e3:08:00 SRC=117.80.234.157 DST=46.62.133.47 LEN=40 TOS=0x00 PREC=0x00 TTL=234 ID=26865 PROTO=TCP SPT=59543 DPT=2375 WINDOW=1024 RES=0x00 SYN URGP=0 
2025-08-10T15:36:40.783540+00:00 ubuntu-4gb-hel1-2 kernel: [UFW BLOCK] IN=eth0 OUT= MAC=96:00:04:64:d8:5e:d2:74:7f:6e:37:e3:08:00 SRC=79.124.62.230 DST=46.62.133.47 LEN=44 TOS=0x00 PREC=0x00 TTL=243 ID=49720 PROTO=TCP SPT=59191 DPT=47001 WINDOW=1025 RES=0x00 SYN URGP=0 
2025-08-10T15:37:00.766382+00:00 ubuntu-4gb-hel1-2 kernel: [UFW BLOCK] IN=eth0 OUT= MAC=96:00:04:64:d8:5e:d2:74:7f:6e:37:e3:08:00 SRC=35.203.210.7 DST=46.62.133.47 LEN=44 TOS=0x00 PREC=0x00 TTL=248 ID=54321 PROTO=TCP SPT=57324 DPT=50505 WINDOW=65535 RES=0x00 SYN URGP=0 
2025-08-10T15:37:17.714905+00:00 ubuntu-4gb-hel1-2 kernel: [UFW BLOCK] IN=eth0 OUT= MAC=96:00:04:64:d8:5e:d2:74:7f:6e:37:e3:08:00 SRC=45.79.109.236 DST=46.62.133.47 LEN=44 TOS=0x00 PREC=0x00 TTL=233 ID=54321 PROTO=TCP SPT=59366 DPT=8443 WINDOW=65535 RES=0x00 SYN URGP=0 
2025-08-10T15:37:49.982768+00:00 ubuntu-4gb-hel1-2 kernel: [UFW BLOCK] IN=eth0 OUT= MAC=96:00:04:64:d8:5e:d2:74:7f:6e:37:e3:08:00 SRC=194.180.49.130 DST=46.62.133.47 LEN=40 TOS=0x00 PREC=0x40 TTL=245 ID=32372 PROTO=TCP SPT=55799 DPT=8259 WINDOW=1024 RES=0x00 SYN URGP=0 
2025-08-10T15:38:25.362293+00:00 ubuntu-4gb-hel1-2 kernel: [UFW BLOCK] IN=eth0 OUT= MAC=96:00:04:64:d8:5e:d2:74:7f:6e:37:e3:08:00 SRC=79.124.8.120 DST=46.62.133.47 LEN=40 TOS=0x00 PREC=0x00 TTL=244 ID=54321 PROTO=TCP SPT=51903 DPT=23 WINDOW=65535 RES=0x00 SYN URGP=0 
2025-08-10T15:39:04.613002+00:00 ubuntu-4gb-hel1-2 kernel: [UFW BLOCK] IN=eth0 OUT= MAC=96:00:04:64:d8:5e:d2:74:7f:6e:37:e3:08:00 SRC=162.19.224.156 DST=46.62.133.47 LEN=61 TOS=0x00 PREC=0x00 TTL=49 ID=54 DF PROTO=UDP SPT=22141 DPT=4000 LEN=41 
2025-08-10T15:39:13.287853+00:00 ubuntu-4gb-hel1-2 kernel: [UFW BLOCK] IN=eth0 OUT= MAC=96:00:04:64:d8:5e:d2:74:7f:6e:37:e3:08:00 SRC=46.8.112.2 DST=46.62.133.47 LEN=44 TOS=0x00 PREC=0x00 TTL=242 ID=39675 PROTO=TCP SPT=58914 DPT=2580 WINDOW=1024 RES=0x00 SYN URGP=0 
2025-08-10T15:39:20.493485+00:00 ubuntu-4gb-hel1-2 kernel: [UFW BLOCK] IN=eth0 OUT= MAC=96:00:04:64:d8:5e:d2:74:7f:6e:37:e3:08:00 SRC=35.203.210.72 DST=46.62.133.47 LEN=44 TOS=0x00 PREC=0x00 TTL=248 ID=54321 PROTO=TCP SPT=55238 DPT=47690 WINDOW=65535 RES=0x00 SYN URGP=0 
2025-08-10T15:39:22.195825+00:00 ubuntu-4gb-hel1-2 kernel: [UFW BLOCK] IN=eth0 OUT= MAC=96:00:04:64:d8:5e:d2:74:7f:6e:37:e3:08:00 SRC=18.217.194.148 DST=46.62.133.47 LEN=40 TOS=0x00 PREC=0x00 TTL=237 ID=54321 PROTO=TCP SPT=46506 DPT=8087 WINDOW=65535 RES=0x00 SYN URGP=0 
2025-08-10T15:39:38.996256+00:00 ubuntu-4gb-hel1-2 kernel: [UFW BLOCK] IN=eth0 OUT= MAC=96:00:04:64:d8:5e:d2:74:7f:6e:37:e3:86:dd SRC=2a06:4880:6000:0000:0000:0000:0000:0078 DST=2a01:04f9:c013:05d3:0000:0000:0000:0001 LEN=64 TC=0 HOPLIMIT=242 FLOWLBL=268180 PROTO=TCP SPT=55986 DPT=58603 WINDOW=14600 RES=0x00 SYN URGP=0 
2025-08-10T15:39:49.351667+00:00 ubuntu-4gb-hel1-2 kernel: [UFW BLOCK] IN=eth0 OUT= MAC=96:00:04:64:d8:5e:d2:74:7f:6e:37:e3:08:00 SRC=194.180.49.130 DST=46.62.133.47 LEN=40 TOS=0x00 PREC=0x40 TTL=245 ID=55572 PROTO=TCP SPT=55799 DPT=9000 WINDOW=1024 RES=0x00 SYN URGP=0 
2025-08-10T15:40:02.900703+00:00 ubuntu-4gb-hel1-2 kernel: [UFW BLOCK] IN=eth0 OUT= MAC=96:00:04:64:d8:5e:d2:74:7f:6e:37:e3:08:00 SRC=155.94.155.178 DST=46.62.133.47 LEN=48 TOS=0x00 PREC=0x00 TTL=110 ID=24850 DF PROTO=TCP SPT=51100 DPT=465 WINDOW=8192 RES=0x00 SYN URGP=0 
2025-08-10T15:40:25.023648+00:00 ubuntu-4gb-hel1-2 kernel: [UFW BLOCK] IN=eth0 OUT= MAC=96:00:04:64:d8:5e:d2:74:7f:6e:37:e3:08:00 SRC=35.203.211.96 DST=46.62.133.47 LEN=44 TOS=0x00 PREC=0x00 TTL=248 ID=54321 PROTO=TCP SPT=55678 DPT=9686 WINDOW=65535 RES=0x00 SYN URGP=0 
2025-08-10T15:40:41.247640+00:00 ubuntu-4gb-hel1-2 kernel: [UFW BLOCK] IN=eth0 OUT= MAC=96:00:04:64:d8:5e:d2:74:7f:6e:37:e3:08:00 SRC=155.94.155.178 DST=46.62.133.47 LEN=52 TOS=0x02 PREC=0x00 TTL=110 ID=16694 DF PROTO=TCP SPT=63747 DPT=587 WINDOW=8192 RES=0x00 CWR ECE SYN URGP=0 
2025-08-10T15:40:57.145351+00:00 ubuntu-4gb-hel1-2 kernel: [UFW BLOCK] IN=eth0 OUT= MAC=96:00:04:64:d8:5e:d2:74:7f:6e:37:e3:08:00 SRC=91.196.152.152 DST=46.62.133.47 LEN=60 TOS=0x00 PREC=0x00 TTL=51 ID=4042 DF PROTO=TCP SPT=4816 DPT=29840 WINDOW=5840 RES=0x00 SYN URGP=0 
2025-08-10T15:41:18.491591+00:00 ubuntu-4gb-hel1-2 kernel: [UFW BLOCK] IN=eth0 OUT= MAC=96:00:04:64:d8:5e:d2:74:7f:6e:37:e3:08:00 SRC=155.94.155.178 DST=46.62.133.47 LEN=48 TOS=0x00 PREC=0x00 TTL=110 ID=9379 DF PROTO=TCP SPT=63181 DPT=25 WINDOW=8192 RES=0x00 SYN URGP=0 
2025-08-10T15:41:50.344591+00:00 ubuntu-4gb-hel1-2 kernel: [UFW BLOCK] IN=eth0 OUT= MAC=96:00:04:64:d8:5e:d2:74:7f:6e:37:e3:08:00 SRC=35.203.211.44 DST=46.62.133.47 LEN=44 TOS=0x00 PREC=0x00 TTL=248 ID=54321 PROTO=TCP SPT=50548 DPT=9366 WINDOW=65535 RES=0x00 SYN URGP=0 
2025-08-10T15:42:02.574927+00:00 ubuntu-4gb-hel1-2 kernel: [UFW BLOCK] IN=eth0 OUT= MAC=96:00:04:64:d8:5e:d2:74:7f:6e:37:e3:08:00 SRC=204.76.203.193 DST=46.62.133.47 LEN=40 TOS=0x00 PREC=0x00 TTL=246 ID=54321 PROTO=TCP SPT=54503 DPT=6969 WINDOW=65535 RES=0x00 SYN URGP=0 
2025-08-10T15:42:25.459325+00:00 ubuntu-4gb-hel1-2 kernel: [UFW BLOCK] IN=eth0 OUT= MAC=96:00:04:64:d8:5e:d2:74:7f:6e:37:e3:08:00 SRC=35.203.210.143 DST=46.62.133.47 LEN=44 TOS=0x00 PREC=0x00 TTL=248 ID=54321 PROTO=TCP SPT=51353 DPT=49148 WINDOW=65535 RES=0x00 SYN URGP=0 
2025-08-10T15:42:50.092631+00:00 ubuntu-4gb-hel1-2 kernel: [UFW BLOCK] IN=eth0 OUT= MAC=96:00:04:64:d8:5e:d2:74:7f:6e:37:e3:08:00 SRC=40.67.161.178 DST=46.62.133.47 LEN=40 TOS=0x00 PREC=0x00 TTL=234 ID=54321 PROTO=TCP SPT=46516 DPT=8443 WINDOW=65535 RES=0x00 SYN URGP=0 
2025-08-10T15:43:03.600726+00:00 ubuntu-4gb-hel1-2 kernel: [UFW BLOCK] IN=eth0 OUT= MAC=96:00:04:64:d8:5e:d2:74:7f:6e:37:e3:08:00 SRC=162.216.149.29 DST=46.62.133.47 LEN=44 TOS=0x00 PREC=0x00 TTL=248 ID=54321 PROTO=TCP SPT=49829 DPT=10017 WINDOW=65535 RES=0x00 SYN URGP=0 
2025-08-10T15:43:19.043204+00:00 ubuntu-4gb-hel1-2 kernel: [UFW BLOCK] IN=eth0 OUT= MAC=96:00:04:64:d8:5e:d2:74:7f:6e:37:e3:08:00 SRC=83.222.191.2 DST=46.62.133.47 LEN=40 TOS=0x00 PREC=0x00 TTL=243 ID=21040 PROTO=TCP SPT=53802 DPT=4004 WINDOW=1024 RES=0x00 SYN URGP=0 
2025-08-10T15:44:10.358412+00:00 ubuntu-4gb-hel1-2 kernel: [UFW BLOCK] IN=eth0 OUT= MAC=96:00:04:64:d8:5e:d2:74:7f:6e:37:e3:08:00 SRC=193.163.125.156 DST=46.62.133.47 LEN=44 TOS=0x08 PREC=0x20 TTL=242 ID=45815 PROTO=TCP SPT=56062 DPT=3389 WINDOW=14600 RES=0x00 SYN URGP=0 
2025-08-10T15:44:12.609264+00:00 ubuntu-4gb-hel1-2 kernel: [UFW BLOCK] IN=eth0 OUT= MAC=96:00:04:64:d8:5e:d2:74:7f:6e:37:e3:08:00 SRC=83.222.190.246 DST=46.62.133.47 LEN=44 TOS=0x00 PREC=0x00 TTL=243 ID=41373 PROTO=TCP SPT=42144 DPT=57000 WINDOW=1025 RES=0x00 SYN URGP=0 
2025-08-10T15:44:30.616953+00:00 ubuntu-4gb-hel1-2 kernel: [UFW BLOCK] IN=eth0 OUT= MAC=96:00:04:64:d8:5e:d2:74:7f:6e:37:e3:08:00 SRC=207.90.244.18 DST=46.62.133.47 LEN=44 TOS=0x00 PREC=0x00 TTL=104 ID=30024 PROTO=TCP SPT=26200 DPT=9928 WINDOW=9076 RES=0x00 SYN URGP=0 
2025-08-10T15:44:39.651333+00:00 ubuntu-4gb-hel1-2 kernel: [UFW BLOCK] IN=eth0 OUT= MAC=96:00:04:64:d8:5e:d2:74:7f:6e:37:e3:08:00 SRC=194.180.49.130 DST=46.62.133.47 LEN=40 TOS=0x00 PREC=0x40 TTL=245 ID=56488 PROTO=TCP SPT=55799 DPT=8781 WINDOW=1024 RES=0x00 SYN URGP=0 
2025-08-10T15:44:54.730894+00:00 ubuntu-4gb-hel1-2 kernel: [UFW BLOCK] IN=eth0 OUT= MAC=96:00:04:64:d8:5e:d2:74:7f:6e:37:e3:86:dd SRC=2a06:4880:6000:0000:0000:0000:0000:0086 DST=2a01:04f9:c013:05d3:0000:0000:0000:0001 LEN=64 TC=0 HOPLIMIT=241 FLOWLBL=1047846 PROTO=TCP SPT=35311 DPT=49172 WINDOW=14600 RES=0x00 SYN URGP=0 
2025-08-10T15:44:57.765388+00:00 ubuntu-4gb-hel1-2 kernel: [UFW BLOCK] IN=eth0 OUT= MAC=96:00:04:64:d8:5e:d2:74:7f:6e:37:e3:08:00 SRC=79.124.62.230 DST=46.62.133.47 LEN=44 TOS=0x00 PREC=0x00 TTL=243 ID=50866 PROTO=TCP SPT=59191 DPT=3389 WINDOW=1025 RES=0x00 SYN URGP=0 

# --- systemd timers ---
NEXT                                 LEFT LAST                              PASSED UNIT                           ACTIVATES
Sun 2025-08-10 15:46:01 UTC           28s Sun 2025-08-10 15:45:01 UTC      31s ago vscode-move.timer              vscode-move.service
Sun 2025-08-10 15:48:04 UTC      2min 31s Sun 2025-08-10 15:43:03 UTC 2min 28s ago socks5-healthcheck.timer       socks5-healthcheck.service
Sun 2025-08-10 15:50:00 UTC      4min 27s Sun 2025-08-10 15:40:01 UTC     5min ago sysstat-collect.timer          sysstat-collect.service
Sun 2025-08-10 16:28:16 UTC         42min Sun 2025-08-10 15:28:16 UTC    17min ago git-autopush.timer             git-autopush.service
Sun 2025-08-10 20:06:44 UTC      4h 21min Sun 2025-08-10 09:13:42 UTC       6h ago apt-daily.timer                apt-daily.service
Mon 2025-08-11 00:00:00 UTC            8h Sun 2025-08-10 00:00:01 UTC      15h ago dpkg-db-backup.timer           dpkg-db-backup.service
Mon 2025-08-11 00:00:00 UTC            8h Sun 2025-08-10 00:00:01 UTC      15h ago logrotate.timer                logrotate.service
Mon 2025-08-11 00:07:00 UTC            8h Sun 2025-08-10 00:07:01 UTC      15h ago sysstat-summary.timer          sysstat-summary.service
Mon 2025-08-11 01:15:34 UTC            9h Mon 2025-08-04 01:39:40 UTC            - fstrim.timer                   fstrim.service
Mon 2025-08-11 03:38:44 UTC           11h Sun 2025-08-10 03:31:00 UTC      12h ago socks5tun-update.timer         socks5tun-update.service
Mon 2025-08-11 04:49:16 UTC           13h Sun 2025-08-10 15:04:16 UTC    41min ago certbot.timer                  certbot.service
Mon 2025-08-11 05:44:09 UTC           13h Sun 2025-08-10 03:31:05 UTC      12h ago man-db.timer                   man-db.service
Mon 2025-08-11 06:07:41 UTC           14h Sun 2025-08-10 06:59:15 UTC       8h ago apt-daily-upgrade.timer        apt-daily-upgrade.service
Mon 2025-08-11 10:07:50 UTC           18h Sun 2025-08-10 15:18:23 UTC    27min ago motd-news.timer                motd-news.service
Mon 2025-08-11 11:57:01 UTC           20h Sun 2025-08-10 11:57:01 UTC 3h 48min ago update-notifier-download.timer update-notifier-download.service
Mon 2025-08-11 12:07:09 UTC           20h Sun 2025-08-10 12:07:09 UTC 3h 38min ago etckeeper.timer                etckeeper.service
Mon 2025-08-11 12:07:09 UTC           20h Sun 2025-08-10 12:07:09 UTC 3h 38min ago systemd-tmpfiles-clean.timer   systemd-tmpfiles-clean.service
Sun 2025-08-17 03:10:04 UTC        6 days Sun 2025-08-10 03:11:01 UTC      12h ago e2scrub_all.timer              e2scrub_all.service
Sun 2025-08-17 05:00:00 UTC        6 days Sun 2025-08-10 05:00:00 UTC      10h ago xray-update.timer              xray-update.service
Wed 2025-08-20 20:24:01 UTC 1 week 3 days Sun 2025-08-10 15:19:51 UTC    25min ago update-notifier-motd.timer     update-notifier-motd.service
-                                       - -                                      - apport-autoreport.timer        apport-autoreport.service
-                                       - -                                      - snapd.snap-repair.timer        snapd.snap-repair.service
-                                       - -                                      - ua-timer.timer                 ua-timer.service

23 timers listed.

# --- systemctl running ---
  UNIT                        LOAD   ACTIVE SUB     DESCRIPTION
  atd.service                 loaded active running Deferred execution scheduler
  blackbox_exporter.service   loaded active running Blackbox Exporter
  cron.service                loaded active running Regular background program processing daemon
  dbus.service                loaded active running D-Bus System Message Bus
  getty@tty1.service          loaded active running Getty on tty1
  grafana-server.service      loaded active running Grafana instance
  multipathd.service          loaded active running Device-Mapper Multipath Device Controller
  named.service               loaded active running BIND Domain Name Server
  nginx.service               loaded active running A high performance web server and a reverse proxy server
  node_exporter.service       loaded active running Node Exporter
  polkit.service              loaded active running Authorization Manager
  prometheus.service          loaded active running Prometheus Monitoring
  qemu-guest-agent.service    loaded active running QEMU Guest Agent
  rsyslog.service             loaded active running System Logging Service
  serial-getty@ttyS0.service  loaded active running Serial Getty on ttyS0
  snapd.service               loaded active running Snap Daemon
  socks5tun.service           loaded active running SOCKS5TUN proxy server
  ssh.service                 loaded active running OpenBSD Secure Shell server
  strongswan.service          loaded active running strongSwan IPsec IKEv1/IKEv2 daemon using swanctl
  stunnel.service             loaded active running TLS wrapper for SOCKS5TUN
  systemd-journald.service    loaded active running Journal Service
  systemd-logind.service      loaded active running User Login Management
  systemd-networkd.service    loaded active running Network Configuration
  systemd-resolved.service    loaded active running Network Name Resolution
  systemd-timesyncd.service   loaded active running Network Time Synchronization
  systemd-udevd.service       loaded active running Rule-based Manager for Device Events and Files
  unattended-upgrades.service loaded active running Unattended Upgrades Shutdown
  user@0.service              loaded active running User Manager for UID 0
  ws-bridge.service           loaded active running WebSocket <-> TCP bridge (websocat)

Legend: LOAD   ‚Üí Reflects whether the unit definition was properly loaded.
        ACTIVE ‚Üí The high-level unit activation state, i.e. generalization of SUB.
        SUB    ‚Üí The low-level unit activation state, values depend on unit type.

29 loaded units listed.

# --- ss -tunlp ---
Netid State  Recv-Q Send-Q                    Local Address:Port  Peer Address:PortProcess                                                                               
udp   UNCONN 0      0                              10.8.0.1:53         0.0.0.0:*    users:(("named",pid=829,fd=54))                                                      
udp   UNCONN 0      0                              10.8.0.1:53         0.0.0.0:*    users:(("named",pid=829,fd=55))                                                      
udp   UNCONN 0      0                            127.0.0.54:53         0.0.0.0:*    users:(("systemd-resolve",pid=2761,fd=16))                                           
udp   UNCONN 0      0                         127.0.0.53%lo:53         0.0.0.0:*    users:(("systemd-resolve",pid=2761,fd=14))                                           
udp   UNCONN 0      0                          46.62.133.47:53         0.0.0.0:*    users:(("named",pid=829,fd=34))                                                      
udp   UNCONN 0      0                          46.62.133.47:53         0.0.0.0:*    users:(("named",pid=829,fd=35))                                                      
udp   UNCONN 0      0                             127.0.0.1:53         0.0.0.0:*    users:(("named",pid=829,fd=29))                                                      
udp   UNCONN 0      0                             127.0.0.1:53         0.0.0.0:*    users:(("named",pid=829,fd=28))                                                      
udp   UNCONN 0      0                     46.62.133.47%eth0:68         0.0.0.0:*    users:(("systemd-network",pid=771,fd=22))                                            
udp   UNCONN 0      0                               0.0.0.0:68         0.0.0.0:*    users:(("charon-systemd",pid=838,fd=26))                                             
udp   UNCONN 0      0                               0.0.0.0:4500       0.0.0.0:*    users:(("charon-systemd",pid=838,fd=19))                                             
udp   UNCONN 0      0                               0.0.0.0:500        0.0.0.0:*    users:(("charon-systemd",pid=838,fd=18))                                             
udp   UNCONN 0      0                                 [::1]:53            [::]:*    users:(("named",pid=829,fd=38))                                                      
udp   UNCONN 0      0                                 [::1]:53            [::]:*    users:(("named",pid=829,fd=39))                                                      
udp   UNCONN 0      0                [2a01:4f9:c013:5d3::1]:53            [::]:*    users:(("named",pid=829,fd=42))                                                      
udp   UNCONN 0      0                [2a01:4f9:c013:5d3::1]:53            [::]:*    users:(("named",pid=829,fd=43))                                                      
udp   UNCONN 0      0       [fe80::9400:4ff:fe64:d85e]%eth0:53            [::]:*    users:(("named",pid=829,fd=47))                                                      
udp   UNCONN 0      0       [fe80::9400:4ff:fe64:d85e]%eth0:53            [::]:*    users:(("named",pid=829,fd=46))                                                      
udp   UNCONN 0      0      [fe80::ed4f:cfd3:4456:c081]%tun0:53            [::]:*    users:(("named",pid=829,fd=60))                                                      
udp   UNCONN 0      0      [fe80::ed4f:cfd3:4456:c081]%tun0:53            [::]:*    users:(("named",pid=829,fd=59))                                                      
udp   UNCONN 0      0                       [fd00:0:0:8::1]:53            [::]:*    users:(("named",pid=829,fd=64))                                                      
udp   UNCONN 0      0                       [fd00:0:0:8::1]:53            [::]:*    users:(("named",pid=829,fd=63))                                                      
udp   UNCONN 0      0                                  [::]:4500          [::]:*    users:(("charon-systemd",pid=838,fd=17))                                             
udp   UNCONN 0      0                                  [::]:500           [::]:*    users:(("charon-systemd",pid=838,fd=16))                                             
udp   UNCONN 0      0                                     *:5000             *:*    users:(("python",pid=329125,fd=4))                                                   
tcp   LISTEN 0      1024                          127.0.0.1:35057      0.0.0.0:*    users:(("code-e3550cfac4",pid=329428,fd=9))                                          
tcp   LISTEN 0      10                            127.0.0.1:53         0.0.0.0:*    users:(("named",pid=829,fd=32))                                                      
tcp   LISTEN 0      10                            127.0.0.1:53         0.0.0.0:*    users:(("named",pid=829,fd=30))                                                      
tcp   LISTEN 0      5                             127.0.0.1:953        0.0.0.0:*    users:(("named",pid=829,fd=51))                                                      
tcp   LISTEN 0      5                             127.0.0.1:953        0.0.0.0:*    users:(("named",pid=829,fd=50))                                                      
tcp   LISTEN 0      1024                          127.0.0.1:5001       0.0.0.0:*    users:(("websocat",pid=297748,fd=6))                                                 
tcp   LISTEN 0      10                         46.62.133.47:53         0.0.0.0:*    users:(("named",pid=829,fd=37))                                                      
tcp   LISTEN 0      10                         46.62.133.47:53         0.0.0.0:*    users:(("named",pid=829,fd=36))                                                      
tcp   LISTEN 0      4096                          127.0.0.1:11443      0.0.0.0:*    users:(("stunnel",pid=312292,fd=9))                                                  
tcp   LISTEN 0      4096                         127.0.0.54:53         0.0.0.0:*    users:(("systemd-resolve",pid=2761,fd=17))                                           
tcp   LISTEN 0      128                             0.0.0.0:5000       0.0.0.0:*    users:(("python",pid=329125,fd=5))                                                   
tcp   LISTEN 0      4096                      127.0.0.53%lo:53         0.0.0.0:*    users:(("systemd-resolve",pid=2761,fd=15))                                           
tcp   LISTEN 0      4096                            0.0.0.0:22         0.0.0.0:*    users:(("sshd",pid=332377,fd=3),("systemd",pid=1,fd=247))                            
tcp   LISTEN 0      10                             10.8.0.1:53         0.0.0.0:*    users:(("named",pid=829,fd=56))                                                      
tcp   LISTEN 0      10                             10.8.0.1:53         0.0.0.0:*    users:(("named",pid=829,fd=58))                                                      
tcp   LISTEN 0      511                             0.0.0.0:80         0.0.0.0:*    users:(("nginx",pid=299623,fd=5),("nginx",pid=299622,fd=5),("nginx",pid=288527,fd=5))
tcp   LISTEN 0      5                                 [::1]:953           [::]:*    users:(("named",pid=829,fd=53))                                                      
tcp   LISTEN 0      5                                 [::1]:953           [::]:*    users:(("named",pid=829,fd=52))                                                      
tcp   LISTEN 0      511                                   *:5737             *:*    users:(("node",pid=330092,fd=23))                                                    
tcp   LISTEN 0      10     [fe80::ed4f:cfd3:4456:c081]%tun0:53            [::]:*    users:(("named",pid=829,fd=62))                                                      
tcp   LISTEN 0      10     [fe80::ed4f:cfd3:4456:c081]%tun0:53            [::]:*    users:(("named",pid=829,fd=61))                                                      
tcp   LISTEN 0      10                                [::1]:53            [::]:*    users:(("named",pid=829,fd=41))                                                      
tcp   LISTEN 0      10                                [::1]:53            [::]:*    users:(("named",pid=829,fd=40))                                                      
tcp   LISTEN 0      4096                                  *:9100             *:*    users:(("node_exporter",pid=125716,fd=3))                                            
tcp   LISTEN 0      4096                                  *:9090             *:*    users:(("prometheus",pid=125029,fd=7))                                               
tcp   LISTEN 0      4096                                  *:9115             *:*    users:(("blackbox_export",pid=124237,fd=3))                                          
tcp   LISTEN 0      4096                                  *:3000             *:*    users:(("grafana",pid=121770,fd=11))                                                 
tcp   LISTEN 0      10                      [fd00:0:0:8::1]:53            [::]:*    users:(("named",pid=829,fd=66))                                                      
tcp   LISTEN 0      10                      [fd00:0:0:8::1]:53            [::]:*    users:(("named",pid=829,fd=65))                                                      
tcp   LISTEN 0      10      [fe80::9400:4ff:fe64:d85e]%eth0:53            [::]:*    users:(("named",pid=829,fd=48))                                                      
tcp   LISTEN 0      10      [fe80::9400:4ff:fe64:d85e]%eth0:53            [::]:*    users:(("named",pid=829,fd=49))                                                      
tcp   LISTEN 0      10               [2a01:4f9:c013:5d3::1]:53            [::]:*    users:(("named",pid=829,fd=44))                                                      
tcp   LISTEN 0      10               [2a01:4f9:c013:5d3::1]:53            [::]:*    users:(("named",pid=829,fd=45))                                                      
tcp   LISTEN 0      4096                               [::]:22            [::]:*    users:(("sshd",pid=332377,fd=4),("systemd",pid=1,fd=249))                            
tcp   LISTEN 0      511                                [::]:80            [::]:*    users:(("nginx",pid=299623,fd=6),("nginx",pid=299622,fd=6),("nginx",pid=288527,fd=6))

# --- journal socks5tun ---
Aug 10 15:38:07 ubuntu-4gb-hel1-2 python[329125]: 2025-08-10 15:38:07 [INFO] [MainThread] [LOCAL] TCP connection from 127.0.0.1:57214 (329125 python)
Aug 10 15:38:07 ubuntu-4gb-hel1-2 python[329125]: 2025-08-10 15:38:07 [WARNING] [Thread-156 (_handle_client)] üëÄ LOCAL connection from 127.0.0.1 ‚Äî likely self-initiated
Aug 10 15:38:07 ubuntu-4gb-hel1-2 python[329125]: 2025-08-10 15:38:07 [INFO] [Thread-156 (_handle_client)] üîÅ [LOCAL/SELF] Connection from 127.0.0.1 closed prematurely (329125 python)
Aug 10 15:38:22 ubuntu-4gb-hel1-2 python[329125]: 2025-08-10 15:38:22 [INFO] [MainThread] [LOCAL] TCP connection from 127.0.0.1:35124 (329125 python)
Aug 10 15:38:22 ubuntu-4gb-hel1-2 python[329125]: 2025-08-10 15:38:22 [WARNING] [Thread-157 (_handle_client)] üëÄ LOCAL connection from 127.0.0.1 ‚Äî likely self-initiated
Aug 10 15:38:22 ubuntu-4gb-hel1-2 python[329125]: 2025-08-10 15:38:22 [INFO] [Thread-157 (_handle_client)] üîÅ [LOCAL/SELF] Connection from 127.0.0.1 closed prematurely (329125 python)
Aug 10 15:38:37 ubuntu-4gb-hel1-2 python[329125]: 2025-08-10 15:38:37 [INFO] [MainThread] [LOCAL] TCP connection from 127.0.0.1:43324 (329125 python)
Aug 10 15:38:37 ubuntu-4gb-hel1-2 python[329125]: 2025-08-10 15:38:37 [WARNING] [Thread-158 (_handle_client)] üëÄ LOCAL connection from 127.0.0.1 ‚Äî likely self-initiated
Aug 10 15:38:37 ubuntu-4gb-hel1-2 python[329125]: 2025-08-10 15:38:37 [INFO] [Thread-158 (_handle_client)] üîÅ [LOCAL/SELF] Connection from 127.0.0.1 closed prematurely (329125 python)
Aug 10 15:38:52 ubuntu-4gb-hel1-2 python[329125]: 2025-08-10 15:38:52 [INFO] [MainThread] [LOCAL] TCP connection from 127.0.0.1:42510 (329125 python)
Aug 10 15:38:52 ubuntu-4gb-hel1-2 python[329125]: 2025-08-10 15:38:52 [WARNING] [Thread-159 (_handle_client)] üëÄ LOCAL connection from 127.0.0.1 ‚Äî likely self-initiated
Aug 10 15:38:52 ubuntu-4gb-hel1-2 python[329125]: 2025-08-10 15:38:52 [INFO] [Thread-159 (_handle_client)] üîÅ [LOCAL/SELF] Connection from 127.0.0.1 closed prematurely (329125 python)
Aug 10 15:39:07 ubuntu-4gb-hel1-2 python[329125]: 2025-08-10 15:39:07 [INFO] [MainThread] [LOCAL] TCP connection from 127.0.0.1:34110 (329125 python)
Aug 10 15:39:07 ubuntu-4gb-hel1-2 python[329125]: 2025-08-10 15:39:07 [WARNING] [Thread-160 (_handle_client)] üëÄ LOCAL connection from 127.0.0.1 ‚Äî likely self-initiated
Aug 10 15:39:07 ubuntu-4gb-hel1-2 python[329125]: 2025-08-10 15:39:07 [INFO] [Thread-160 (_handle_client)] üîÅ [LOCAL/SELF] Connection from 127.0.0.1 closed prematurely (329125 python)
Aug 10 15:39:22 ubuntu-4gb-hel1-2 python[329125]: 2025-08-10 15:39:22 [INFO] [MainThread] [LOCAL] TCP connection from 127.0.0.1:56926 (329125 python)
Aug 10 15:39:22 ubuntu-4gb-hel1-2 python[329125]: 2025-08-10 15:39:22 [WARNING] [Thread-161 (_handle_client)] üëÄ LOCAL connection from 127.0.0.1 ‚Äî likely self-initiated
Aug 10 15:39:22 ubuntu-4gb-hel1-2 python[329125]: 2025-08-10 15:39:22 [INFO] [Thread-161 (_handle_client)] üîÅ [LOCAL/SELF] Connection from 127.0.0.1 closed prematurely (329125 python)
Aug 10 15:39:37 ubuntu-4gb-hel1-2 python[329125]: 2025-08-10 15:39:37 [INFO] [MainThread] [LOCAL] TCP connection from 127.0.0.1:55138 (329125 python)
Aug 10 15:39:37 ubuntu-4gb-hel1-2 python[329125]: 2025-08-10 15:39:37 [WARNING] [Thread-162 (_handle_client)] üëÄ LOCAL connection from 127.0.0.1 ‚Äî likely self-initiated
Aug 10 15:39:37 ubuntu-4gb-hel1-2 python[329125]: 2025-08-10 15:39:37 [INFO] [Thread-162 (_handle_client)] üîÅ [LOCAL/SELF] Connection from 127.0.0.1 closed prematurely (329125 python)
Aug 10 15:39:52 ubuntu-4gb-hel1-2 python[329125]: 2025-08-10 15:39:52 [INFO] [MainThread] [LOCAL] TCP connection from 127.0.0.1:41370 (329125 python)
Aug 10 15:39:52 ubuntu-4gb-hel1-2 python[329125]: 2025-08-10 15:39:52 [WARNING] [Thread-163 (_handle_client)] üëÄ LOCAL connection from 127.0.0.1 ‚Äî likely self-initiated
Aug 10 15:39:52 ubuntu-4gb-hel1-2 python[329125]: 2025-08-10 15:39:52 [INFO] [Thread-163 (_handle_client)] üîÅ [LOCAL/SELF] Connection from 127.0.0.1 closed prematurely (329125 python)
Aug 10 15:40:07 ubuntu-4gb-hel1-2 python[329125]: 2025-08-10 15:40:07 [INFO] [MainThread] [LOCAL] TCP connection from 127.0.0.1:48338 (329125 python)
Aug 10 15:40:07 ubuntu-4gb-hel1-2 python[329125]: 2025-08-10 15:40:07 [WARNING] [Thread-164 (_handle_client)] üëÄ LOCAL connection from 127.0.0.1 ‚Äî likely self-initiated
Aug 10 15:40:07 ubuntu-4gb-hel1-2 python[329125]: 2025-08-10 15:40:07 [INFO] [Thread-164 (_handle_client)] üîÅ [LOCAL/SELF] Connection from 127.0.0.1 closed prematurely (329125 python)
Aug 10 15:40:22 ubuntu-4gb-hel1-2 python[329125]: 2025-08-10 15:40:22 [INFO] [MainThread] [LOCAL] TCP connection from 127.0.0.1:58906 (329125 python)
Aug 10 15:40:22 ubuntu-4gb-hel1-2 python[329125]: 2025-08-10 15:40:22 [WARNING] [Thread-165 (_handle_client)] üëÄ LOCAL connection from 127.0.0.1 ‚Äî likely self-initiated
Aug 10 15:40:22 ubuntu-4gb-hel1-2 python[329125]: 2025-08-10 15:40:22 [INFO] [Thread-165 (_handle_client)] üîÅ [LOCAL/SELF] Connection from 127.0.0.1 closed prematurely (329125 python)
Aug 10 15:40:37 ubuntu-4gb-hel1-2 python[329125]: 2025-08-10 15:40:37 [INFO] [MainThread] [LOCAL] TCP connection from 127.0.0.1:34972 (329125 python)
Aug 10 15:40:37 ubuntu-4gb-hel1-2 python[329125]: 2025-08-10 15:40:37 [WARNING] [Thread-166 (_handle_client)] üëÄ LOCAL connection from 127.0.0.1 ‚Äî likely self-initiated
Aug 10 15:40:37 ubuntu-4gb-hel1-2 python[329125]: 2025-08-10 15:40:37 [INFO] [Thread-166 (_handle_client)] üîÅ [LOCAL/SELF] Connection from 127.0.0.1 closed prematurely (329125 python)
Aug 10 15:40:52 ubuntu-4gb-hel1-2 python[329125]: 2025-08-10 15:40:52 [INFO] [MainThread] [LOCAL] TCP connection from 127.0.0.1:57410 (329125 python)
Aug 10 15:40:52 ubuntu-4gb-hel1-2 python[329125]: 2025-08-10 15:40:52 [WARNING] [Thread-167 (_handle_client)] üëÄ LOCAL connection from 127.0.0.1 ‚Äî likely self-initiated
Aug 10 15:40:52 ubuntu-4gb-hel1-2 python[329125]: 2025-08-10 15:40:52 [INFO] [Thread-167 (_handle_client)] üîÅ [LOCAL/SELF] Connection from 127.0.0.1 closed prematurely (329125 python)
Aug 10 15:41:07 ubuntu-4gb-hel1-2 python[329125]: 2025-08-10 15:41:07 [INFO] [MainThread] [LOCAL] TCP connection from 127.0.0.1:39664 (329125 python)
Aug 10 15:41:07 ubuntu-4gb-hel1-2 python[329125]: 2025-08-10 15:41:07 [WARNING] [Thread-168 (_handle_client)] üëÄ LOCAL connection from 127.0.0.1 ‚Äî likely self-initiated
Aug 10 15:41:07 ubuntu-4gb-hel1-2 python[329125]: 2025-08-10 15:41:07 [INFO] [Thread-168 (_handle_client)] üîÅ [LOCAL/SELF] Connection from 127.0.0.1 closed prematurely (329125 python)
Aug 10 15:41:22 ubuntu-4gb-hel1-2 python[329125]: 2025-08-10 15:41:22 [INFO] [MainThread] [LOCAL] TCP connection from 127.0.0.1:45374 (329125 python)
Aug 10 15:41:22 ubuntu-4gb-hel1-2 python[329125]: 2025-08-10 15:41:22 [WARNING] [Thread-169 (_handle_client)] üëÄ LOCAL connection from 127.0.0.1 ‚Äî likely self-initiated
Aug 10 15:41:22 ubuntu-4gb-hel1-2 python[329125]: 2025-08-10 15:41:22 [INFO] [Thread-169 (_handle_client)] üîÅ [LOCAL/SELF] Connection from 127.0.0.1 closed prematurely (329125 python)
Aug 10 15:41:37 ubuntu-4gb-hel1-2 python[329125]: 2025-08-10 15:41:37 [INFO] [MainThread] [LOCAL] TCP connection from 127.0.0.1:46604 (329125 python)
Aug 10 15:41:37 ubuntu-4gb-hel1-2 python[329125]: 2025-08-10 15:41:37 [WARNING] [Thread-170 (_handle_client)] üëÄ LOCAL connection from 127.0.0.1 ‚Äî likely self-initiated
Aug 10 15:41:37 ubuntu-4gb-hel1-2 python[329125]: 2025-08-10 15:41:37 [INFO] [Thread-170 (_handle_client)] üîÅ [LOCAL/SELF] Connection from 127.0.0.1 closed prematurely (329125 python)
Aug 10 15:41:52 ubuntu-4gb-hel1-2 python[329125]: 2025-08-10 15:41:52 [INFO] [MainThread] [LOCAL] TCP connection from 127.0.0.1:38534 (329125 python)
Aug 10 15:41:52 ubuntu-4gb-hel1-2 python[329125]: 2025-08-10 15:41:52 [WARNING] [Thread-171 (_handle_client)] üëÄ LOCAL connection from 127.0.0.1 ‚Äî likely self-initiated
Aug 10 15:41:52 ubuntu-4gb-hel1-2 python[329125]: 2025-08-10 15:41:52 [INFO] [Thread-171 (_handle_client)] üîÅ [LOCAL/SELF] Connection from 127.0.0.1 closed prematurely (329125 python)
Aug 10 15:42:07 ubuntu-4gb-hel1-2 python[329125]: 2025-08-10 15:42:07 [INFO] [MainThread] [LOCAL] TCP connection from 127.0.0.1:60750 (329125 python)
Aug 10 15:42:07 ubuntu-4gb-hel1-2 python[329125]: 2025-08-10 15:42:07 [WARNING] [Thread-172 (_handle_client)] üëÄ LOCAL connection from 127.0.0.1 ‚Äî likely self-initiated
Aug 10 15:42:07 ubuntu-4gb-hel1-2 python[329125]: 2025-08-10 15:42:07 [INFO] [Thread-172 (_handle_client)] üîÅ [LOCAL/SELF] Connection from 127.0.0.1 closed prematurely (329125 python)
Aug 10 15:42:22 ubuntu-4gb-hel1-2 python[329125]: 2025-08-10 15:42:22 [INFO] [MainThread] [LOCAL] TCP connection from 127.0.0.1:52200 (329125 python)
Aug 10 15:42:22 ubuntu-4gb-hel1-2 python[329125]: 2025-08-10 15:42:22 [WARNING] [Thread-173 (_handle_client)] üëÄ LOCAL connection from 127.0.0.1 ‚Äî likely self-initiated
Aug 10 15:42:22 ubuntu-4gb-hel1-2 python[329125]: 2025-08-10 15:42:22 [INFO] [Thread-173 (_handle_client)] üîÅ [LOCAL/SELF] Connection from 127.0.0.1 closed prematurely (329125 python)
Aug 10 15:42:37 ubuntu-4gb-hel1-2 python[329125]: 2025-08-10 15:42:37 [INFO] [MainThread] [LOCAL] TCP connection from 127.0.0.1:38318 (329125 python)
Aug 10 15:42:37 ubuntu-4gb-hel1-2 python[329125]: 2025-08-10 15:42:37 [WARNING] [Thread-174 (_handle_client)] üëÄ LOCAL connection from 127.0.0.1 ‚Äî likely self-initiated
Aug 10 15:42:37 ubuntu-4gb-hel1-2 python[329125]: 2025-08-10 15:42:37 [INFO] [Thread-174 (_handle_client)] üîÅ [LOCAL/SELF] Connection from 127.0.0.1 closed prematurely (329125 python)
Aug 10 15:42:52 ubuntu-4gb-hel1-2 python[329125]: 2025-08-10 15:42:52 [INFO] [MainThread] [LOCAL] TCP connection from 127.0.0.1:53938 (329125 python)
Aug 10 15:42:52 ubuntu-4gb-hel1-2 python[329125]: 2025-08-10 15:42:52 [WARNING] [Thread-175 (_handle_client)] üëÄ LOCAL connection from 127.0.0.1 ‚Äî likely self-initiated
Aug 10 15:42:52 ubuntu-4gb-hel1-2 python[329125]: 2025-08-10 15:42:52 [INFO] [Thread-175 (_handle_client)] üîÅ [LOCAL/SELF] Connection from 127.0.0.1 closed prematurely (329125 python)
Aug 10 15:43:04 ubuntu-4gb-hel1-2 python[329125]: 2025-08-10 15:43:04 [INFO] [MainThread] [LOCAL] TCP connection from 127.0.0.1:53560 (329125 python)
Aug 10 15:43:04 ubuntu-4gb-hel1-2 python[329125]: 2025-08-10 15:43:04 [WARNING] [Thread-176 (_handle_client)] üëÄ LOCAL connection from 127.0.0.1 ‚Äî likely self-initiated
Aug 10 15:43:04 ubuntu-4gb-hel1-2 python[329125]: 2025-08-10 15:43:04 [WARNING] [Thread-176 (_handle_client)] [SNIFF] First 2 bytes from 127.0.0.1:53560: hex=0502 ascii=b'\x05\x02'
Aug 10 15:43:04 ubuntu-4gb-hel1-2 python[329125]: 2025-08-10 15:43:04 [INFO] [Thread-176 (_handle_client)] SOCKS5 handshake header from 127.0.0.1: 0502
Aug 10 15:43:04 ubuntu-4gb-hel1-2 python[329125]: 2025-08-10 15:43:04 [INFO] [Thread-176 (_handle_client)] SOCKS5 methods from 127.0.0.1: 0001
Aug 10 15:43:04 ubuntu-4gb-hel1-2 python[329125]: 2025-08-10 15:43:04 [DEBUG] [Thread-176 (_handle_client)] [DEBUG] Waiting for SOCKS5 request from 127.0.0.1:53560...
Aug 10 15:43:04 ubuntu-4gb-hel1-2 python[329125]: 2025-08-10 15:43:04 [DEBUG] [Thread-176 (_handle_client)] [DEBUG] Waiting for SOCKS5 request from 127.0.0.1:53560...
Aug 10 15:43:04 ubuntu-4gb-hel1-2 python[329125]: 2025-08-10 15:43:04 [INFO] [Thread-176 (_handle_client)] SOCKS5 request header from 127.0.0.1: 05010003
Aug 10 15:43:04 ubuntu-4gb-hel1-2 python[329125]: 2025-08-10 15:43:04 [INFO] [Thread-176 (_handle_client)] Established TCP tunnel from 127.0.0.1 to 172.67.168.106:443
Aug 10 15:43:04 ubuntu-4gb-hel1-2 python[329125]: 2025-08-10 15:43:04 [INFO] [Thread-176 (_handle_client)] Closed TCP tunnel for 127.0.0.1
Aug 10 15:43:07 ubuntu-4gb-hel1-2 python[329125]: 2025-08-10 15:43:07 [INFO] [MainThread] [LOCAL] TCP connection from 127.0.0.1:53568 (329125 python)
Aug 10 15:43:07 ubuntu-4gb-hel1-2 python[329125]: 2025-08-10 15:43:07 [WARNING] [Thread-177 (_handle_client)] üëÄ LOCAL connection from 127.0.0.1 ‚Äî likely self-initiated
Aug 10 15:43:07 ubuntu-4gb-hel1-2 python[329125]: 2025-08-10 15:43:07 [INFO] [Thread-177 (_handle_client)] üîÅ [LOCAL/SELF] Connection from 127.0.0.1 closed prematurely (329125 python)
Aug 10 15:43:22 ubuntu-4gb-hel1-2 python[329125]: 2025-08-10 15:43:22 [INFO] [MainThread] [LOCAL] TCP connection from 127.0.0.1:60668 (329125 python)
Aug 10 15:43:22 ubuntu-4gb-hel1-2 python[329125]: 2025-08-10 15:43:22 [WARNING] [Thread-178 (_handle_client)] üëÄ LOCAL connection from 127.0.0.1 ‚Äî likely self-initiated
Aug 10 15:43:22 ubuntu-4gb-hel1-2 python[329125]: 2025-08-10 15:43:22 [INFO] [Thread-178 (_handle_client)] üîÅ [LOCAL/SELF] Connection from 127.0.0.1 closed prematurely (329125 python)
Aug 10 15:43:37 ubuntu-4gb-hel1-2 python[329125]: 2025-08-10 15:43:37 [INFO] [MainThread] [LOCAL] TCP connection from 127.0.0.1:46036 (329125 python)
Aug 10 15:43:37 ubuntu-4gb-hel1-2 python[329125]: 2025-08-10 15:43:37 [WARNING] [Thread-179 (_handle_client)] üëÄ LOCAL connection from 127.0.0.1 ‚Äî likely self-initiated
Aug 10 15:43:37 ubuntu-4gb-hel1-2 python[329125]: 2025-08-10 15:43:37 [INFO] [Thread-179 (_handle_client)] üîÅ [LOCAL/SELF] Connection from 127.0.0.1 closed prematurely (329125 python)
Aug 10 15:43:52 ubuntu-4gb-hel1-2 python[329125]: 2025-08-10 15:43:52 [INFO] [MainThread] [LOCAL] TCP connection from 127.0.0.1:55386 (329125 python)
Aug 10 15:43:52 ubuntu-4gb-hel1-2 python[329125]: 2025-08-10 15:43:52 [WARNING] [Thread-180 (_handle_client)] üëÄ LOCAL connection from 127.0.0.1 ‚Äî likely self-initiated
Aug 10 15:43:52 ubuntu-4gb-hel1-2 python[329125]: 2025-08-10 15:43:52 [INFO] [Thread-180 (_handle_client)] üîÅ [LOCAL/SELF] Connection from 127.0.0.1 closed prematurely (329125 python)
Aug 10 15:44:07 ubuntu-4gb-hel1-2 python[329125]: 2025-08-10 15:44:07 [INFO] [MainThread] [LOCAL] TCP connection from 127.0.0.1:37980 (329125 python)
Aug 10 15:44:07 ubuntu-4gb-hel1-2 python[329125]: 2025-08-10 15:44:07 [WARNING] [Thread-181 (_handle_client)] üëÄ LOCAL connection from 127.0.0.1 ‚Äî likely self-initiated
Aug 10 15:44:07 ubuntu-4gb-hel1-2 python[329125]: 2025-08-10 15:44:07 [INFO] [Thread-181 (_handle_client)] üîÅ [LOCAL/SELF] Connection from 127.0.0.1 closed prematurely (329125 python)
Aug 10 15:44:22 ubuntu-4gb-hel1-2 python[329125]: 2025-08-10 15:44:22 [INFO] [MainThread] [LOCAL] TCP connection from 127.0.0.1:57022 (329125 python)
Aug 10 15:44:22 ubuntu-4gb-hel1-2 python[329125]: 2025-08-10 15:44:22 [WARNING] [Thread-182 (_handle_client)] üëÄ LOCAL connection from 127.0.0.1 ‚Äî likely self-initiated
Aug 10 15:44:22 ubuntu-4gb-hel1-2 python[329125]: 2025-08-10 15:44:22 [INFO] [Thread-182 (_handle_client)] üîÅ [LOCAL/SELF] Connection from 127.0.0.1 closed prematurely (329125 python)
Aug 10 15:44:37 ubuntu-4gb-hel1-2 python[329125]: 2025-08-10 15:44:37 [INFO] [MainThread] [LOCAL] TCP connection from 127.0.0.1:42786 (329125 python)
Aug 10 15:44:37 ubuntu-4gb-hel1-2 python[329125]: 2025-08-10 15:44:37 [WARNING] [Thread-183 (_handle_client)] üëÄ LOCAL connection from 127.0.0.1 ‚Äî likely self-initiated
Aug 10 15:44:37 ubuntu-4gb-hel1-2 python[329125]: 2025-08-10 15:44:37 [INFO] [Thread-183 (_handle_client)] üîÅ [LOCAL/SELF] Connection from 127.0.0.1 closed prematurely (329125 python)
Aug 10 15:44:52 ubuntu-4gb-hel1-2 python[329125]: 2025-08-10 15:44:52 [INFO] [MainThread] [LOCAL] TCP connection from 127.0.0.1:50196 (329125 python)
Aug 10 15:44:52 ubuntu-4gb-hel1-2 python[329125]: 2025-08-10 15:44:52 [WARNING] [Thread-184 (_handle_client)] üëÄ LOCAL connection from 127.0.0.1 ‚Äî likely self-initiated
Aug 10 15:44:52 ubuntu-4gb-hel1-2 python[329125]: 2025-08-10 15:44:52 [INFO] [Thread-184 (_handle_client)] üîÅ [LOCAL/SELF] Connection from 127.0.0.1 closed prematurely (329125 python)
Aug 10 15:45:07 ubuntu-4gb-hel1-2 python[329125]: 2025-08-10 15:45:07 [INFO] [MainThread] [LOCAL] TCP connection from 127.0.0.1:39292 (329125 python)
Aug 10 15:45:07 ubuntu-4gb-hel1-2 python[329125]: 2025-08-10 15:45:07 [WARNING] [Thread-185 (_handle_client)] üëÄ LOCAL connection from 127.0.0.1 ‚Äî likely self-initiated
Aug 10 15:45:07 ubuntu-4gb-hel1-2 python[329125]: 2025-08-10 15:45:07 [INFO] [Thread-185 (_handle_client)] üîÅ [LOCAL/SELF] Connection from 127.0.0.1 closed prematurely (329125 python)
Aug 10 15:45:22 ubuntu-4gb-hel1-2 python[329125]: 2025-08-10 15:45:22 [INFO] [MainThread] [LOCAL] TCP connection from 127.0.0.1:49430 (329125 python)
Aug 10 15:45:22 ubuntu-4gb-hel1-2 python[329125]: 2025-08-10 15:45:22 [WARNING] [Thread-186 (_handle_client)] üëÄ LOCAL connection from 127.0.0.1 ‚Äî likely self-initiated
Aug 10 15:45:22 ubuntu-4gb-hel1-2 python[329125]: 2025-08-10 15:45:22 [INFO] [Thread-186 (_handle_client)] üîÅ [LOCAL/SELF] Connection from 127.0.0.1 closed prematurely (329125 python)

# --- journal ws-bridge ---
Aug 10 10:45:56 ubuntu-4gb-hel1-2 systemd[1]: Started ws-bridge.service - WebSocket <-> TCP bridge (websocat).
Aug 10 10:46:41 ubuntu-4gb-hel1-2 websocat[297748]: websocat: Connection reset by peer (os error 104)
Aug 10 10:51:05 ubuntu-4gb-hel1-2 websocat[297748]: websocat: Connection reset by peer (os error 104)
Aug 10 10:57:44 ubuntu-4gb-hel1-2 websocat[297748]: websocat: Connection reset by peer (os error 104)
Aug 10 11:16:35 ubuntu-4gb-hel1-2 websocat[297748]: websocat: Connection reset by peer (os error 104)
Aug 10 11:16:48 ubuntu-4gb-hel1-2 websocat[297748]: websocat: Connection reset by peer (os error 104)
Aug 10 11:32:40 ubuntu-4gb-hel1-2 websocat[297748]: websocat: WebSocketError: I/O failure

# --- systemctl ws-bridge ---
‚óè ws-bridge.service - WebSocket <-> TCP bridge (websocat)
     Loaded: loaded (/etc/systemd/system/ws-bridge.service; enabled; preset: enabled)
     Active: active (running) since Sun 2025-08-10 10:45:56 UTC; 4h 59min ago
   Main PID: 297748 (websocat)
      Tasks: 1 (limit: 4540)
     Memory: 156.0K (peak: 1.1M swap: 548.0K swap peak: 548.0K)
        CPU: 44ms
     CGroup: /system.slice/ws-bridge.service
             ‚îî‚îÄ297748 /usr/local/bin/websocat --binary -E ws-l:127.0.0.1:5001 tcp:127.0.0.1:5000

Aug 10 10:45:56 ubuntu-4gb-hel1-2 systemd[1]: Started ws-bridge.service - WebSocket <-> TCP bridge (websocat).
Aug 10 10:46:41 ubuntu-4gb-hel1-2 websocat[297748]: websocat: Connection reset by peer (os error 104)
Aug 10 10:51:05 ubuntu-4gb-hel1-2 websocat[297748]: websocat: Connection reset by peer (os error 104)
Aug 10 10:57:44 ubuntu-4gb-hel1-2 websocat[297748]: websocat: Connection reset by peer (os error 104)
Aug 10 11:16:35 ubuntu-4gb-hel1-2 websocat[297748]: websocat: Connection reset by peer (os error 104)
Aug 10 11:16:48 ubuntu-4gb-hel1-2 websocat[297748]: websocat: Connection reset by peer (os error 104)
Aug 10 11:32:40 ubuntu-4gb-hel1-2 websocat[297748]: websocat: WebSocketError: I/O failure

# --- pip freeze ---
build==1.3.0
coverage==7.10.2
debugpy==1.8.15
iniconfig==2.1.0
packaging==25.0
pluggy==1.6.0
psutil==7.0.0
Pygments==2.19.2
pyproject_hooks==1.2.0
pyroute2==0.9.3
pytest==8.4.1
pytest-cov==6.2.1
pytest-timeout==2.4.0
-e git+ssh://git@github.com/MaratShamsutdinov/socks5tun.git@e65d39416ba4f55310a2b39f5a41a33ad91d9147#egg=socks5tun
types-psutil==7.0.0.20250801

# --- iptables-save ---
# Generated by iptables-save v1.8.10 (nf_tables) on Sun Aug 10 15:45:33 2025
*filter
:INPUT DROP [45784:6083045]
:FORWARD DROP [0:0]
:OUTPUT ACCEPT [704:49497]
:ufw-after-forward - [0:0]
:ufw-after-input - [0:0]
:ufw-after-logging-forward - [0:0]
:ufw-after-logging-input - [0:0]
:ufw-after-logging-output - [0:0]
:ufw-after-output - [0:0]
:ufw-before-forward - [0:0]
:ufw-before-input - [0:0]
:ufw-before-logging-forward - [0:0]
:ufw-before-logging-input - [0:0]
:ufw-before-logging-output - [0:0]
:ufw-before-output - [0:0]
:ufw-logging-allow - [0:0]
:ufw-logging-deny - [0:0]
:ufw-not-local - [0:0]
:ufw-reject-forward - [0:0]
:ufw-reject-input - [0:0]
:ufw-reject-output - [0:0]
:ufw-skip-to-policy-forward - [0:0]
:ufw-skip-to-policy-input - [0:0]
:ufw-skip-to-policy-output - [0:0]
:ufw-track-forward - [0:0]
:ufw-track-input - [0:0]
:ufw-track-output - [0:0]
:ufw-user-forward - [0:0]
:ufw-user-input - [0:0]
:ufw-user-limit - [0:0]
:ufw-user-limit-accept - [0:0]
:ufw-user-logging-forward - [0:0]
:ufw-user-logging-input - [0:0]
:ufw-user-logging-output - [0:0]
:ufw-user-output - [0:0]
-A INPUT -j ufw-before-logging-input
-A INPUT -j ufw-before-input
-A INPUT -j ufw-after-input
-A INPUT -j ufw-after-logging-input
-A INPUT -j ufw-reject-input
-A INPUT -j ufw-track-input
-A FORWARD -j ufw-before-logging-forward
-A FORWARD -j ufw-before-forward
-A FORWARD -j ufw-after-forward
-A FORWARD -j ufw-after-logging-forward
-A FORWARD -j ufw-reject-forward
-A FORWARD -j ufw-track-forward
-A OUTPUT -j ufw-before-logging-output
-A OUTPUT -j ufw-before-output
-A OUTPUT -j ufw-after-output
-A OUTPUT -j ufw-after-logging-output
-A OUTPUT -j ufw-reject-output
-A OUTPUT -j ufw-track-output
-A ufw-after-input -p udp -m udp --dport 137 -j ufw-skip-to-policy-input
-A ufw-after-input -p udp -m udp --dport 138 -j ufw-skip-to-policy-input
-A ufw-after-input -p tcp -m tcp --dport 139 -j ufw-skip-to-policy-input
-A ufw-after-input -p tcp -m tcp --dport 445 -j ufw-skip-to-policy-input
-A ufw-after-input -p udp -m udp --dport 67 -j ufw-skip-to-policy-input
-A ufw-after-input -p udp -m udp --dport 68 -j ufw-skip-to-policy-input
-A ufw-after-input -m addrtype --dst-type BROADCAST -j ufw-skip-to-policy-input
-A ufw-after-logging-forward -m limit --limit 3/min --limit-burst 10 -j LOG --log-prefix "[UFW BLOCK] "
-A ufw-after-logging-input -m limit --limit 3/min --limit-burst 10 -j LOG --log-prefix "[UFW BLOCK] "
-A ufw-before-forward -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT
-A ufw-before-forward -p icmp -m icmp --icmp-type 3 -j ACCEPT
-A ufw-before-forward -p icmp -m icmp --icmp-type 11 -j ACCEPT
-A ufw-before-forward -p icmp -m icmp --icmp-type 12 -j ACCEPT
-A ufw-before-forward -p icmp -m icmp --icmp-type 8 -j ACCEPT
-A ufw-before-forward -j ufw-user-forward
-A ufw-before-input -i lo -j ACCEPT
-A ufw-before-input -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT
-A ufw-before-input -m conntrack --ctstate INVALID -j ufw-logging-deny
-A ufw-before-input -m conntrack --ctstate INVALID -j DROP
-A ufw-before-input -p icmp -m icmp --icmp-type 3 -j ACCEPT
-A ufw-before-input -p icmp -m icmp --icmp-type 11 -j ACCEPT
-A ufw-before-input -p icmp -m icmp --icmp-type 12 -j ACCEPT
-A ufw-before-input -p icmp -m icmp --icmp-type 8 -j ACCEPT
-A ufw-before-input -p udp -m udp --sport 67 --dport 68 -j ACCEPT
-A ufw-before-input -j ufw-not-local
-A ufw-before-input -d 224.0.0.251/32 -p udp -m udp --dport 5353 -j ACCEPT
-A ufw-before-input -d 239.255.255.250/32 -p udp -m udp --dport 1900 -j ACCEPT
-A ufw-before-input -j ufw-user-input
-A ufw-before-output -o lo -j ACCEPT
-A ufw-before-output -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT
-A ufw-before-output -j ufw-user-output
-A ufw-logging-allow -m limit --limit 3/min --limit-burst 10 -j LOG --log-prefix "[UFW ALLOW] "
-A ufw-logging-deny -m conntrack --ctstate INVALID -m limit --limit 3/min --limit-burst 10 -j RETURN
-A ufw-logging-deny -m limit --limit 3/min --limit-burst 10 -j LOG --log-prefix "[UFW BLOCK] "
-A ufw-not-local -m addrtype --dst-type LOCAL -j RETURN
-A ufw-not-local -m addrtype --dst-type MULTICAST -j RETURN
-A ufw-not-local -m addrtype --dst-type BROADCAST -j RETURN
-A ufw-not-local -m limit --limit 3/min --limit-burst 10 -j ufw-logging-deny
-A ufw-not-local -j DROP
-A ufw-skip-to-policy-forward -j DROP
-A ufw-skip-to-policy-input -j DROP
-A ufw-skip-to-policy-output -j ACCEPT
-A ufw-track-output -p tcp -m conntrack --ctstate NEW -j ACCEPT
-A ufw-track-output -p udp -m conntrack --ctstate NEW -j ACCEPT
-A ufw-user-input -s 172.64.0.0/13 -p tcp -m tcp --dport 80 -j ACCEPT
-A ufw-user-input -s 104.24.0.0/14 -p tcp -m tcp --dport 80 -j ACCEPT
-A ufw-user-input -s 104.16.0.0/13 -p tcp -m tcp --dport 80 -j ACCEPT
-A ufw-user-input -s 162.158.0.0/15 -p tcp -m tcp --dport 80 -j ACCEPT
-A ufw-user-input -s 198.41.128.0/17 -p tcp -m tcp --dport 80 -j ACCEPT
-A ufw-user-input -s 197.234.240.0/22 -p tcp -m tcp --dport 80 -j ACCEPT
-A ufw-user-input -s 188.114.96.0/20 -p tcp -m tcp --dport 80 -j ACCEPT
-A ufw-user-input -s 190.93.240.0/20 -p tcp -m tcp --dport 80 -j ACCEPT
-A ufw-user-input -s 108.162.192.0/18 -p tcp -m tcp --dport 80 -j ACCEPT
-A ufw-user-input -s 141.101.64.0/18 -p tcp -m tcp --dport 80 -j ACCEPT
-A ufw-user-input -s 103.31.4.0/22 -p tcp -m tcp --dport 80 -j ACCEPT
-A ufw-user-input -s 103.22.200.0/22 -p tcp -m tcp --dport 80 -j ACCEPT
-A ufw-user-input -s 103.21.244.0/22 -p tcp -m tcp --dport 80 -j ACCEPT
-A ufw-user-input -s 173.245.48.0/20 -p tcp -m tcp --dport 80 -j ACCEPT
-A ufw-user-input -p tcp -m tcp --dport 5000 -j DROP
-A ufw-user-input -p tcp -m tcp --dport 22 -j ACCEPT
-A ufw-user-input -p tcp -m tcp --dport 22 -m comment --comment "\'dapp_OpenSSH\'" -j ACCEPT
-A ufw-user-input -p udp -m udp --dport 5000 -j ACCEPT
-A ufw-user-input -p udp -m multiport --dports 500,4500 -j ACCEPT
-A ufw-user-input -p tcp -m tcp --dport 3000 -j ACCEPT
-A ufw-user-input -p tcp -m tcp --dport 80 -j DROP
-A ufw-user-input -p tcp -m tcp --dport 443 -j DROP
-A ufw-user-limit -m limit --limit 3/min -j LOG --log-prefix "[UFW LIMIT BLOCK] "
-A ufw-user-limit -j REJECT --reject-with icmp-port-unreachable
-A ufw-user-limit-accept -j ACCEPT
COMMIT
# Completed on Sun Aug 10 15:45:33 2025
# Generated by iptables-save v1.8.10 (nf_tables) on Sun Aug 10 15:45:33 2025
*nat
:PREROUTING ACCEPT [0:0]
:INPUT ACCEPT [0:0]
:OUTPUT ACCEPT [0:0]
:POSTROUTING ACCEPT [40724:2868321]
-A POSTROUTING -s 10.8.0.0/24 -o eth0 -j MASQUERADE
COMMIT
# Completed on Sun Aug 10 15:45:33 2025

# --- sysctl ip_forward/tcp ---
net.ipv4.ip_forward = 1
net.ipv4.ip_forward_update_priority = 1
net.ipv4.ip_forward_use_pmtu = 0

# --- crontab root ---
@daily /usr/local/sbin/update_cf_ufw.sh >/tmp/update-cf-ufw.log 2>&1

# --- ip a ---
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host noprefixroute 
       valid_lft forever preferred_lft forever
2: eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP group default qlen 1000
    link/ether 96:00:04:64:d8:5e brd ff:ff:ff:ff:ff:ff
    inet 46.62.133.47/32 metric 100 scope global dynamic eth0
       valid_lft 72384sec preferred_lft 72384sec
    inet6 2a01:4f9:c013:5d3::1/64 scope global 
       valid_lft forever preferred_lft forever
    inet6 fe80::9400:4ff:fe64:d85e/64 scope link 
       valid_lft forever preferred_lft forever
123: tun0: <POINTOPOINT,MULTICAST,NOARP,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UNKNOWN group default qlen 500
    link/none 
    inet 10.8.0.1 peer 10.8.0.2/32 scope global tun0
       valid_lft forever preferred_lft forever
    inet6 fd00:0:0:8::1/128 scope global 
       valid_lft forever preferred_lft forever
    inet6 fe80::ed4f:cfd3:4456:c081/64 scope link stable-privacy 
       valid_lft forever preferred_lft forever

# --- nginx -V ---
nginx version: nginx/1.24.0 (Ubuntu)
built with OpenSSL 3.0.13 30 Jan 2024
TLS SNI support enabled
configure arguments: --with-cc-opt='-g -O2 -fno-omit-frame-pointer -mno-omit-leaf-frame-pointer -ffile-prefix-map=/build/nginx-XLhrax/nginx-1.24.0=. -flto=auto -ffat-lto-objects -fstack-protector-strong -fstack-clash-protection -Wformat -Werror=format-security -fcf-protection -fdebug-prefix-map=/build/nginx-XLhrax/nginx-1.24.0=/usr/src/nginx-1.24.0-2ubuntu7.4 -fPIC -Wdate-time -D_FORTIFY_SOURCE=3' --with-ld-opt='-Wl,-Bsymbolic-functions -flto=auto -ffat-lto-objects -Wl,-z,relro -Wl,-z,now -fPIC' --prefix=/usr/share/nginx --conf-path=/etc/nginx/nginx.conf --http-log-path=/var/log/nginx/access.log --error-log-path=stderr --lock-path=/var/lock/nginx.lock --pid-path=/run/nginx.pid --modules-path=/usr/lib/nginx/modules --http-client-body-temp-path=/var/lib/nginx/body --http-fastcgi-temp-path=/var/lib/nginx/fastcgi --http-proxy-temp-path=/var/lib/nginx/proxy --http-scgi-temp-path=/var/lib/nginx/scgi --http-uwsgi-temp-path=/var/lib/nginx/uwsgi --with-compat --with-debug --with-pcre-jit --with-http_ssl_module --with-http_stub_status_module --with-http_realip_module --with-http_auth_request_module --with-http_v2_module --with-http_dav_module --with-http_slice_module --with-threads --with-http_addition_module --with-http_flv_module --with-http_gunzip_module --with-http_gzip_static_module --with-http_mp4_module --with-http_random_index_module --with-http_secure_link_module --with-http_sub_module --with-mail_ssl_module --with-stream_ssl_module --with-stream_ssl_preread_module --with-stream_realip_module --with-http_geoip_module=dynamic --with-http_image_filter_module=dynamic --with-http_perl_module=dynamic --with-http_xslt_module=dynamic --with-mail=dynamic --with-stream=dynamic --with-stream_geoip_module=dynamic

# --- nginx -T ---
# configuration file /etc/nginx/nginx.conf:
user www-data;
worker_processes auto;
pid /run/nginx.pid;
error_log /var/log/nginx/error.log;
include /etc/nginx/modules-enabled/*.conf;

events {
	worker_connections 768;
	# multi_accept on;
}

http {

	##
	# Basic Settings
	##

	sendfile on;
	tcp_nopush on;
	types_hash_max_size 2048;
	# server_tokens off;

	# server_names_hash_bucket_size 64;
	# server_name_in_redirect off;

	include /etc/nginx/mime.types;
	default_type application/octet-stream;

	##
	# SSL Settings
	##

	ssl_protocols TLSv1 TLSv1.1 TLSv1.2 TLSv1.3; # Dropping SSLv3, ref: POODLE
	ssl_prefer_server_ciphers on;

	##
	# Logging Settings
	##

	access_log /var/log/nginx/access.log;

	##
	# Gzip Settings
	##

	gzip on;

	# gzip_vary on;
	# gzip_proxied any;
	# gzip_comp_level 6;
	# gzip_buffers 16 8k;
	# gzip_http_version 1.1;
	# gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript;

	##
	# Virtual Host Configs
	##

	include /etc/nginx/conf.d/*.conf;
	include /etc/nginx/sites-enabled/*;
}


#mail {
#	# See sample authentication script at:
#	# http://wiki.nginx.org/ImapAuthenticateWithApachePhpScript
#
#	# auth_http localhost/auth.php;
#	# pop3_capabilities "TOP" "USER";
#	# imap_capabilities "IMAP4rev1" "UIDPLUS";
#
#	server {
#		listen     localhost:110;
#		protocol   pop3;
#		proxy      on;
#	}
#
#	server {
#		listen     localhost:143;
#		protocol   imap;
#		proxy      on;
#	}
#}

# configuration file /etc/nginx/mime.types:

types {
    text/html                                        html htm shtml;
    text/css                                         css;
    text/xml                                         xml;
    image/gif                                        gif;
    image/jpeg                                       jpeg jpg;
    application/javascript                           js;
    application/atom+xml                             atom;
    application/rss+xml                              rss;

    text/mathml                                      mml;
    text/plain                                       txt;
    text/vnd.sun.j2me.app-descriptor                 jad;
    text/vnd.wap.wml                                 wml;
    text/x-component                                 htc;

    image/avif                                       avif;
    image/png                                        png;
    image/svg+xml                                    svg svgz;
    image/tiff                                       tif tiff;
    image/vnd.wap.wbmp                               wbmp;
    image/webp                                       webp;
    image/x-icon                                     ico;
    image/x-jng                                      jng;
    image/x-ms-bmp                                   bmp;

    font/woff                                        woff;
    font/woff2                                       woff2;

    application/java-archive                         jar war ear;
    application/json                                 json;
    application/mac-binhex40                         hqx;
    application/msword                               doc;
    application/pdf                                  pdf;
    application/postscript                           ps eps ai;
    application/rtf                                  rtf;
    application/vnd.apple.mpegurl                    m3u8;
    application/vnd.google-earth.kml+xml             kml;
    application/vnd.google-earth.kmz                 kmz;
    application/vnd.ms-excel                         xls;
    application/vnd.ms-fontobject                    eot;
    application/vnd.ms-powerpoint                    ppt;
    application/vnd.oasis.opendocument.graphics      odg;
    application/vnd.oasis.opendocument.presentation  odp;
    application/vnd.oasis.opendocument.spreadsheet   ods;
    application/vnd.oasis.opendocument.text          odt;
    application/vnd.openxmlformats-officedocument.presentationml.presentation
                                                     pptx;
    application/vnd.openxmlformats-officedocument.spreadsheetml.sheet
                                                     xlsx;
    application/vnd.openxmlformats-officedocument.wordprocessingml.document
                                                     docx;
    application/vnd.wap.wmlc                         wmlc;
    application/wasm                                 wasm;
    application/x-7z-compressed                      7z;
    application/x-cocoa                              cco;
    application/x-java-archive-diff                  jardiff;
    application/x-java-jnlp-file                     jnlp;
    application/x-makeself                           run;
    application/x-perl                               pl pm;
    application/x-pilot                              prc pdb;
    application/x-rar-compressed                     rar;
    application/x-redhat-package-manager             rpm;
    application/x-sea                                sea;
    application/x-shockwave-flash                    swf;
    application/x-stuffit                            sit;
    application/x-tcl                                tcl tk;
    application/x-x509-ca-cert                       der pem crt;
    application/x-xpinstall                          xpi;
    application/xhtml+xml                            xhtml;
    application/xspf+xml                             xspf;
    application/zip                                  zip;

    application/octet-stream                         bin exe dll;
    application/octet-stream                         deb;
    application/octet-stream                         dmg;
    application/octet-stream                         iso img;
    application/octet-stream                         msi msp msm;

    audio/midi                                       mid midi kar;
    audio/mpeg                                       mp3;
    audio/ogg                                        ogg;
    audio/x-m4a                                      m4a;
    audio/x-realaudio                                ra;

    video/3gpp                                       3gpp 3gp;
    video/mp2t                                       ts;
    video/mp4                                        mp4;
    video/mpeg                                       mpeg mpg;
    video/ogg                                        ogv;
    video/quicktime                                  mov;
    video/webm                                       webm;
    video/x-flv                                      flv;
    video/x-m4v                                      m4v;
    video/x-matroska                                 mkv;
    video/x-mng                                      mng;
    video/x-ms-asf                                   asx asf;
    video/x-ms-wmv                                   wmv;
    video/x-msvideo                                  avi;
}

# configuration file /etc/nginx/sites-enabled/default:
##
# You should look at the following URL's in order to grasp a solid understanding
# of Nginx configuration files in order to fully unleash the power of Nginx.
# https://www.nginx.com/resources/wiki/start/
# https://www.nginx.com/resources/wiki/start/topics/tutorials/config_pitfalls/
# https://wiki.debian.org/Nginx/DirectoryStructure
#
# In most cases, administrators will remove this file from sites-enabled/ and
# leave it as reference inside of sites-available where it will continue to be
# updated by the nginx packaging team.
#
# This file will automatically load configuration files provided by other
# applications, such as Drupal or Wordpress. These applications will be made
# available underneath a path with that package name, such as /drupal8.
#
# Please see /usr/share/doc/nginx-doc/examples/ for more detailed examples.
##

# Default server configuration
#
server {
	listen 80 default_server;
	listen [::]:80 default_server;

	# SSL configuration
	#
	# listen 443 ssl default_server;
	# listen [::]:443 ssl default_server;
	#
	# Note: You should disable gzip for SSL traffic.
	# See: https://bugs.debian.org/773332
	#
	# Read up on ssl_ciphers to ensure a secure configuration.
	# See: https://bugs.debian.org/765782
	#
	# Self signed certs generated by the ssl-cert package
	# Don't use them in a production server!
	#
	# include snippets/snakeoil.conf;

	root /var/www/html;

	# Add index.php to the list if you are using PHP
	index index.html index.htm index.nginx-debian.html;

	server_name _;

	location / {
		# First attempt to serve request as file, then
		# as directory, then fall back to displaying a 404.
		try_files $uri $uri/ =404;
	}

	# pass PHP scripts to FastCGI server
	#
	#location ~ \.php$ {
	#	include snippets/fastcgi-php.conf;
	#
	#	# With php-fpm (or other unix sockets):
	#	fastcgi_pass unix:/run/php/php7.4-fpm.sock;
	#	# With php-cgi (or other tcp sockets):
	#	fastcgi_pass 127.0.0.1:9000;
	#}

	# deny access to .htaccess files, if Apache's document root
	# concurs with nginx's one
	#
	#location ~ /\.ht {
	#	deny all;
	#}
}


# Virtual Host configuration for example.com
#
# You can move that to a different file under sites-available/ and symlink that
# to sites-enabled/ to enable it.
#
#server {
#	listen 80;
#	listen [::]:80;
#
#	server_name example.com;
#
#	root /var/www/example.com;
#	index index.html;
#
#	location / {
#		try_files $uri $uri/ =404;
#	}
#}

# configuration file /etc/nginx/sites-enabled/ws.conf:
# 1) –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π Connection
map $http_upgrade $connection_upgrade {
    default upgrade;
    ''      close;
}

server {
    listen 80;
    server_name ws.mytunnel.us.com;

    # 2) WS-–≤—Ö–æ–¥: —Ç–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ –ø—É—Ç–∏ (=)
    location = /ws/2i43wj9hqO3alZaBaeiixHQJ {

        # –∫—É–¥–∞ —à—å—ë–º WS
        proxy_pass              http://127.0.0.1:5001;

        # 3) WS must-haves
        proxy_http_version      1.1;
        proxy_set_header        Host $host;
        proxy_set_header        Upgrade $http_upgrade;
        proxy_set_header        Connection $connection_upgrade;

        # 4) –¥–æ–ø. –∑–∞–≥–æ–ª–æ–≤–∫–∏ ‚Äî —á–∞—Å—Ç–æ –ø–æ–º–æ–≥–∞—é—Ç –ø–æ–¥ CF/DPI
        proxy_set_header        X-Forwarded-Proto $scheme;
        proxy_set_header        X-Forwarded-For   $proxy_add_x_forwarded_for;
        proxy_set_header        Origin            https://$host;
        # –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—à—å –ø–æ–¥–ø—Ä–æ—Ç–æ–∫–æ–ª ‚Äî –ø—Ä–æ–±—Ä–∞—Å—ã–≤–∞–µ–º:
        proxy_set_header        Sec-WebSocket-Protocol $http_sec_websocket_protocol;

        # 5) —Ç–∞–π–º–∞—É—Ç—ã –∏ –±—É—Ñ–µ—Ä—ã
        proxy_read_timeout      3600;
        proxy_send_timeout      3600;
        proxy_buffering         off;

        # 6) –æ—Ç–¥–µ–ª—å–Ω—ã–π –ª–æ–≥ –¥–ª—è WS
        access_log /var/log/nginx/ws_access.log;
    }

    # –º–∞—Å–∫–∞ ‚Äî –≤—Å—ë –æ—Å—Ç–∞–ª—å–Ω–æ–µ –ø—Ä—è—á–µ–º
    location / { return 404; }
}


# --- ip r ---
default via 172.31.1.1 dev eth0 proto dhcp src 46.62.133.47 metric 100 
10.8.0.2 dev tun0 proto kernel scope link src 10.8.0.1 
172.31.1.1 dev eth0 proto dhcp scope link src 46.62.133.47 metric 100 
185.12.64.1 via 172.31.1.1 dev eth0 proto dhcp src 46.62.133.47 metric 100 
185.12.64.2 via 172.31.1.1 dev eth0 proto dhcp src 46.62.133.47 metric 100 

# --- ufw status ---
Status: active
Logging: on (low)
Default: deny (incoming), allow (outgoing), deny (routed)
New profiles: skip

To                         Action      From
--                         ------      ----
80/tcp                     ALLOW IN    172.64.0.0/13              # CF-80
80/tcp                     ALLOW IN    104.24.0.0/14              # CF-80
80/tcp                     ALLOW IN    104.16.0.0/13              # CF-80
80/tcp                     ALLOW IN    162.158.0.0/15             # CF-80
80/tcp                     ALLOW IN    198.41.128.0/17            # CF-80
80/tcp                     ALLOW IN    197.234.240.0/22           # CF-80
80/tcp                     ALLOW IN    188.114.96.0/20            # CF-80
80/tcp                     ALLOW IN    190.93.240.0/20            # CF-80
80/tcp                     ALLOW IN    108.162.192.0/18           # CF-80
80/tcp                     ALLOW IN    141.101.64.0/18            # CF-80
80/tcp                     ALLOW IN    103.31.4.0/22              # CF-80
80/tcp                     ALLOW IN    103.22.200.0/22            # CF-80
80/tcp                     ALLOW IN    103.21.244.0/22            # CF-80
80/tcp                     ALLOW IN    173.245.48.0/20            # CF-80
5000/tcp                   DENY IN     Anywhere                  
22/tcp                     ALLOW IN    Anywhere                   # SSH –¥–æ—Å—Ç—É–ø
22/tcp (OpenSSH)           ALLOW IN    Anywhere                  
5000/udp                   ALLOW IN    Anywhere                   # TUN gateway UDP
500,4500/udp               ALLOW IN    Anywhere                   # IPsec VPN (strongSwan)
3000/tcp                   ALLOW IN    Anywhere                   # Grafana Web UI
80/tcp                     DENY IN     Anywhere                  
443/tcp                    DENY IN     Anywhere                  
80/tcp                     ALLOW IN    2a06:98c0::/29             # CF-80
80/tcp                     ALLOW IN    2405:8100::/32             # CF-80
80/tcp                     ALLOW IN    2405:b500::/32             # CF-80
80/tcp                     ALLOW IN    2803:f800::/32             # CF-80
80/tcp                     ALLOW IN    2606:4700::/32             # CF-80
80/tcp                     ALLOW IN    2400:cb00::/32             # CF-80
5000/tcp (v6)              DENY IN     Anywhere (v6)             
22/tcp (v6)                ALLOW IN    Anywhere (v6)              # SSH –¥–æ—Å—Ç—É–ø
22/tcp (OpenSSH (v6))      ALLOW IN    Anywhere (v6)             
5000/udp (v6)              ALLOW IN    Anywhere (v6)              # TUN gateway UDP
500,4500/udp (v6)          ALLOW IN    Anywhere (v6)              # IPsec VPN (strongSwan)
3000/tcp (v6)              ALLOW IN    Anywhere (v6)              # Grafana Web UI
80/tcp (v6)                DENY IN     Anywhere (v6)             
443/tcp (v6)               DENY IN     Anywhere (v6)             


# --- systemctl is-enabled (nginx/ws-bridge/socks5tun) ---
nginx: enabled
ws-bridge: enabled
socks5tun: enabled

# --- systemctl is-active (nginx/ws-bridge/socks5tun) ---
nginx: active
ws-bridge: active
socks5tun: active

# --- nginx.conf ---
user www-data;
worker_processes auto;
pid /run/nginx.pid;
error_log /var/log/nginx/error.log;
include /etc/nginx/modules-enabled/*.conf;

events {
	worker_connections 768;
	# multi_accept on;
}

http {

	##
	# Basic Settings
	##

	sendfile on;
	tcp_nopush on;
	types_hash_max_size 2048;
	# server_tokens off;

	# server_names_hash_bucket_size 64;
	# server_name_in_redirect off;

	include /etc/nginx/mime.types;
	default_type application/octet-stream;

	##
	# SSL Settings
	##

	ssl_protocols TLSv1 TLSv1.1 TLSv1.2 TLSv1.3; # Dropping SSLv3, ref: POODLE
	ssl_prefer_server_ciphers on;

	##
	# Logging Settings
	##

	access_log /var/log/nginx/access.log;

	##
	# Gzip Settings
	##

	gzip on;

	# gzip_vary on;
	# gzip_proxied any;
	# gzip_comp_level 6;
	# gzip_buffers 16 8k;
	# gzip_http_version 1.1;
	# gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript;

	##
	# Virtual Host Configs
	##

	include /etc/nginx/conf.d/*.conf;
	include /etc/nginx/sites-enabled/*;
}


#mail {
#	# See sample authentication script at:
#	# http://wiki.nginx.org/ImapAuthenticateWithApachePhpScript
#
#	# auth_http localhost/auth.php;
#	# pop3_capabilities "TOP" "USER";
#	# imap_capabilities "IMAP4rev1" "UIDPLUS";
#
#	server {
#		listen     localhost:110;
#		protocol   pop3;
#		proxy      on;
#	}
#
#	server {
#		listen     localhost:143;
#		protocol   imap;
#		proxy      on;
#	}
#}

# --- update_cf_ufw.sh (Cloudflare UFW) - optional ---
#!/usr/bin/env bash
set -euo pipefail

PORTS=(80 443)
UFW() { ufw --force "$@"; }

# –£–¥–∞–ª—è–µ–º –≤—Å–µ —Å—Ç–∞—Ä—ã–µ –ø—Ä–∞–≤–∏–ª–∞ —Å –∫–æ–º–º–µ–Ω—Ç–æ–º CF-<PORT> (v4 –∏ v6)
delete_cf_rules() {
  local port="$1"
  # –≤—ã—Ç–∞—Å–∫–∏–≤–∞–µ–º –Ω–æ–º–µ—Ä–∞ –ø—Ä–∞–≤–∏–ª –ø–æ –∫–æ–º–º–µ–Ω—Ç—É, —É–¥–∞–ª—è–µ–º —Å–≤–µ—Ä—Ö—É –≤–Ω–∏–∑
  mapfile -t nums < <(ufw status numbered | sed -n "s/^\[\s*\([0-9]\+\)\]\s\+.*# CF-${port}.*$/\1/p" | sort -rn)
  for n in "${nums[@]:-}"; do UFW delete "$n"; done
}

add_cf_rules_for_port() {
  local port="$1"
  # v4 —Å–Ω–∞—á–∞–ª–∞
  curl -fsS https://www.cloudflare.com/ips-v4 | while read -r net; do
    [[ -n "$net" ]] && UFW prepend allow from "$net" to any port "$port" proto tcp comment "CF-${port}"
  done
  # –∑–∞—Ç–µ–º v6
  curl -fsS https://www.cloudflare.com/ips-v6 | while read -r net; do
    [[ -n "$net" ]] && UFW prepend allow from "$net" to any port "$port" proto tcp comment "CF-${port}"
  done
  # –∏ —É–±–µ–¥–∏–º—Å—è, —á—Ç–æ –µ—Å—Ç—å deny (–æ–±–∞ —Å—Ç–µ–∫–∞)
  ufw status | grep -qE "(^| )${port}/tcp.*DENY" || UFW deny "${port}/tcp"
}

for p in "${PORTS[@]}"; do
  delete_cf_rules "$p"
  add_cf_rules_for_port "$p"
done

echo "UFW updated for Cloudflare IPs on ports: ${PORTS[*]}"

# --- last_status ---
up

# --- socks5tun-update.service ---
[Unit]
Description=–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ SOCKS5TUN (wheel + config)
After=network-online.target
Wants=network-online.target

[Service]
Type=oneshot
ExecStart=/usr/local/bin/update_socks5tun.sh

[Install]
WantedBy=multi-user.target
# üí° –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤—Ä—É—á–Ω—É—é –∏–ª–∏ –ø–æ —Ç–∞–π–º–µ—Ä—É

# --- sshd_config ---

# This is the sshd server system-wide configuration file.  See
# sshd_config(5) for more information.

# This sshd was compiled with PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games

# The strategy used for options in the default sshd_config shipped with
# OpenSSH is to specify options with their default value where
# possible, but leave them commented.  Uncommented options override the
# default value.

Include /etc/ssh/sshd_config.d/*.conf

# When systemd socket activation is used (the default), the socket
# configuration must be re-generated after changing Port, AddressFamily, or
# ListenAddress.
#
# For changes to take effect, run:
#
#   systemctl daemon-reload
#   systemctl restart ssh.socket
#
#Port 22
#AddressFamily any
#ListenAddress 0.0.0.0
#ListenAddress ::

#HostKey /etc/ssh/ssh_host_rsa_key
#HostKey /etc/ssh/ssh_host_ecdsa_key
#HostKey /etc/ssh/ssh_host_ed25519_key

# Ciphers and keying
#RekeyLimit default none

# Logging
#SyslogFacility AUTH
#LogLevel INFO

# Authentication:

#LoginGraceTime 2m
#PermitRootLogin prohibit-password
#StrictModes yes
#MaxAuthTries 6
#MaxSessions 10

#PubkeyAuthentication yes

# Expect .ssh/authorized_keys2 to be disregarded by default in future.
#AuthorizedKeysFile	.ssh/authorized_keys .ssh/authorized_keys2

#AuthorizedPrincipalsFile none

#AuthorizedKeysCommand none
#AuthorizedKeysCommandUser nobody

# For this to work you will also need host keys in /etc/ssh/ssh_known_hosts
#HostbasedAuthentication no
# Change to yes if you don't trust ~/.ssh/known_hosts for
# HostbasedAuthentication
#IgnoreUserKnownHosts no
# Don't read the user's ~/.rhosts and ~/.shosts files
#IgnoreRhosts yes

# To disable tunneled clear text passwords, change to no here!
#PasswordAuthentication yes
#PermitEmptyPasswords no

# Change to yes to enable challenge-response passwords (beware issues with
# some PAM modules and threads)
KbdInteractiveAuthentication no

# Kerberos options
#KerberosAuthentication no
#KerberosOrLocalPasswd yes
#KerberosTicketCleanup yes
#KerberosGetAFSToken no

# GSSAPI options
#GSSAPIAuthentication no
#GSSAPICleanupCredentials yes
#GSSAPIStrictAcceptorCheck yes
#GSSAPIKeyExchange no

# Set this to 'yes' to enable PAM authentication, account processing,
# and session processing. If this is enabled, PAM authentication will
# be allowed through the KbdInteractiveAuthentication and
# PasswordAuthentication.  Depending on your PAM configuration,
# PAM authentication via KbdInteractiveAuthentication may bypass
# the setting of "PermitRootLogin prohibit-password".
# If you just want the PAM account and session checks to run without
# PAM authentication, then enable this but set PasswordAuthentication
# and KbdInteractiveAuthentication to 'no'.
UsePAM yes

#AllowAgentForwarding yes
#AllowTcpForwarding yes
#GatewayPorts no
X11Forwarding yes
#X11DisplayOffset 10
#X11UseLocalhost yes
#PermitTTY yes
PrintMotd no
#PrintLastLog yes
#TCPKeepAlive yes
#PermitUserEnvironment no
#Compression delayed
#ClientAliveInterval 0
#ClientAliveCountMax 3
#UseDNS no
#PidFile /run/sshd.pid
#MaxStartups 10:30:100
#PermitTunnel no
#ChrootDirectory none
#VersionAddendum none

# no default banner path
#Banner none

# Allow client to pass locale environment variables
AcceptEnv LANG LC_*

# override default of no subsystems
Subsystem	sftp	/usr/lib/openssh/sftp-server

# Example of overriding settings on a per-user basis
#Match User anoncvs
#	X11Forwarding no
#	AllowTcpForwarding no
#	PermitTTY no
#	ForceCommand cvs server

# --- socks5_telegram_alert.sh ---
#!/usr/bin/env bash

TOKEN="8285785110:AAGaDAsisuGlbMYDCKkAWuYl_wmgzmEsdLQ"
CHAT_ID="271161868"

MSG="üö® *SOCKS5TUN ALERT*: \`$1\` failed on \`$(hostname)\` at \`$(date)\`"
curl -s -X POST https://api.telegram.org/bot${TOKEN}/sendMessage \
     -d chat_id=${CHAT_ID} \
     -d text="$MSG" \
     -d parse_mode=Markdown > /dev/null

# --- socks5tun.service ---
[Unit]
Description=SOCKS5TUN proxy server
Wants=network-online.target
After=network-online.target systemd-networkd-wait-online.service stunnel.service

[Service]
Type=simple
User=root

AmbientCapabilities=CAP_NET_ADMIN CAP_NET_BIND_SERVICE CAP_NET_RAW
CapabilityBoundingSet=CAP_NET_ADMIN CAP_NET_BIND_SERVICE CAP_NET_RAW

ExecStartPre=-/bin/bash /opt/socks5tun/scripts/nat6_setup.sh


ExecStart=/opt/venv-pyroute/bin/python -m socks5tun.run -c /etc/socks5tun/config_prod.json
WorkingDirectory=/opt/socks5tun

Environment=PYTHONUNBUFFERED=1
LimitNOFILE=65535
TasksMax=8192
Restart=on-failure
RestartSec=5
TimeoutStopSec=10
KillSignal=SIGINT

NoNewPrivileges=yes
PrivateTmp=yes
ProtectSystem=full
ProtectHome=true
ProtectControlGroups=yes
PrivateDevices=no
DeviceAllow=/dev/net/tun rw
RestrictAddressFamilies=AF_INET AF_INET6 AF_NETLINK
ProtectKernelModules=yes
ProtectClock=yes
ProtectHostname=yes
ProtectProc=invisible
LockPersonality=yes
SystemCallFilter=~@mount @swap @clock @module @reboot
MountAPIVFS=yes
MemoryDenyWriteExecute=yes

ReadWritePaths=/proc/sys/net/ipv4/ip_forward /etc/sysctl.d /etc/iptables

[Install]
WantedBy=multi-user.target

# --- update_socks5tun.sh ---
#!/bin/bash
set -euo pipefail

PROJECT_DIR="/opt/socks5tun"
VENV_PYTHON="/opt/venv-pyroute/bin/python"
VENV_PIP="/opt/venv-pyroute/bin/pip"
CONFIG_DIR="/etc/socks5tun"
CONFIG_FILE="config_prod.json"
SERVICE_NAME="socks5tun"
SCRIPTS_DIR="$PROJECT_DIR/scripts"
NAT6_SCRIPT="$SCRIPTS_DIR/nat6_setup.sh"

# --- —é–Ω–∏—Ç –∏ –æ–ø—Ü–∏–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ ---
UNIT_PATH="/etc/systemd/system/${SERVICE_NAME}.service"
DROPIN_DIR="/etc/systemd/system/${SERVICE_NAME}.service.d"
VENV_BIN="$VENV_PYTHON"
WORKDIR="$PROJECT_DIR"
CONFIG="$CONFIG_DIR/$CONFIG_FILE"
WANT_STUNNEL="yes"         # "yes"|"no" ‚Äî –µ—Å–ª–∏ stunnel –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω
WANT_IPV4_FORWARD="no"     # "yes"|"no" ‚Äî –µ—Å–ª–∏ –Ω–∞–¥–æ –≤—Å–µ–≥–¥–∞ –≤–∫–ª—é—á–∞—Ç—å ip_forward

log() { echo "[update] $*"; }

cd "$PROJECT_DIR"

log "Building wheel‚Ä¶"
$VENV_PYTHON -m build --wheel --outdir dist/

log "Installing latest wheel‚Ä¶"
LATEST_WHEEL=$(ls -1t dist/*.whl | head -n1)
$VENV_PIP install --upgrade "$LATEST_WHEEL"

# (–æ–ø—Ü.) —á–∏—Å—Ç–∏–º —Å—Ç–∞—Ä—ã–µ –∫–æ–ª—ë—Å–∞, –æ—Å—Ç–∞–≤–ª—è–µ–º 3 –ø–æ—Å–ª–µ–¥–Ω–∏—Ö
ls -1t dist/*.whl | tail -n +4 | xargs -r rm -f

log "Syncing config‚Ä¶"
mkdir -p "$CONFIG_DIR"
if [ -f "$CONFIG_DIR/$CONFIG_FILE" ]; then
  cp -a "$CONFIG_DIR/$CONFIG_FILE" "$CONFIG_DIR/$CONFIG_FILE.bak.$(date +%F_%H%M%S)"
fi
cp -f "$PROJECT_DIR/$CONFIG_FILE" "$CONFIG_DIR/$CONFIG_FILE"

# --------- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è nat6_setup.sh –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞ ---------
log "Generating NAT6 script from config‚Ä¶"
mkdir -p "$SCRIPTS_DIR"

PREFIX6_DEFAULT="fd00:0:0:8::/64"
if command -v jq >/dev/null 2>&1; then
  PREFIX6=$(jq -r '.tun.prefix6 // empty' "$CONFIG_DIR/$CONFIG_FILE")
  WAN_IF=$(jq -r '.nat.out_iface // empty' "$CONFIG_DIR/$CONFIG_FILE")
else
  log "jq not found; using defaults/fallback autodetect"
  PREFIX6=""
  WAN_IF=""
fi

[ -z "${PREFIX6:-}" ] && PREFIX6="$PREFIX6_DEFAULT"
if [ -z "${WAN_IF:-}" ]; then
  # –∞–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ: —Å–Ω–∞—á–∞–ª–∞ –¥–µ—Ñ–æ–ª—Ç–Ω—ã–π v6 –º–∞—Ä—à—Ä—É—Ç, –∑–∞—Ç–µ–º v4, –∑–∞—Ç–µ–º eth0
  WAN_IF=$(ip -o -6 route show default 2>/dev/null | awk '{print $5}' | head -1 || true)
  [ -z "$WAN_IF" ] && WAN_IF=$(ip -o route show default 2>/dev/null | awk '{print $5}' | head -1 || true)
  [ -z "$WAN_IF" ] && WAN_IF="eth0"
fi

cat >"$NAT6_SCRIPT" <<EOF
#!/bin/sh
set -e

# Autogenerated by update_socks5tun.sh ‚Äî do not edit manually.
PREFIX6="$PREFIX6"
WAN_IF="$WAN_IF"

echo "[nat6_setup] prefix6=\$PREFIX6 wan_if=\$WAN_IF"

# 1) IPv6 forwarding: —Å–µ–π—á–∞—Å –∏ –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ
sysctl -w net.ipv6.conf.all.forwarding=1 >/dev/null || true
if [ -d /etc/sysctl.d ]; then
  echo 'net.ipv6.conf.all.forwarding=1' >/etc/sysctl.d/99-socks5tun-ipv6.conf || true
fi

# 2) nftables –∏–ª–∏ ip6tables (–≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å–∏—Å—Ç–µ–º—ã)
if command -v nft >/dev/null 2>&1 && nft list tables 2>/dev/null | grep -q ' ip6 nat'; then
  nft list chain ip6 nat POSTROUTING 2>/dev/null | grep -q "ip6 saddr \$PREFIX6 oif \$WAN_IF masquerade" \
    || nft add rule ip6 nat POSTROUTING ip6 saddr \$PREFIX6 oif \$WAN_IF masquerade
  echo "[nat6_setup] nftables rule ensured"
else
  ip6tables -t nat -C POSTROUTING -s "\$PREFIX6" -o "\$WAN_IF" -j MASQUERADE 2>/dev/null \
    || ip6tables -t nat -A POSTROUTING -s "\$PREFIX6" -o "\$WAN_IF" -j MASQUERADE
  if command -v ip6tables-save >/dev/null 2>&1 && [ -d /etc/iptables ]; then
    ip6tables-save > /etc/iptables/rules.v6 || true
  fi
  echo "[nat6_setup] ip6tables rule ensured"
fi

exit 0
EOF

chmod +x "$NAT6_SCRIPT"

# --------- –ê–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è systemd unit (–∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ) ---------
log "Rendering systemd unit‚Ä¶"
TMP_UNIT="$(mktemp)"
cat >"$TMP_UNIT" <<EOF
[Unit]
Description=SOCKS5TUN proxy server
Wants=network-online.target
After=network-online.target systemd-networkd-wait-online.service$( [ "$WANT_STUNNEL" = "yes" ] && printf " stunnel.service" )

[Service]
Type=simple
User=root

AmbientCapabilities=CAP_NET_ADMIN CAP_NET_BIND_SERVICE CAP_NET_RAW
CapabilityBoundingSet=CAP_NET_ADMIN CAP_NET_BIND_SERVICE CAP_NET_RAW

ExecStartPre=-/bin/bash $WORKDIR/scripts/nat6_setup.sh
$( [ "$WANT_IPV4_FORWARD" = "yes" ] && echo "ExecStartPre=/bin/sh -c 'sysctl -w net.ipv4.ip_forward=1'" )

ExecStart=$VENV_BIN -m socks5tun.run -c $CONFIG
WorkingDirectory=$WORKDIR

Environment=PYTHONUNBUFFERED=1
LimitNOFILE=65535
TasksMax=8192
Restart=on-failure
RestartSec=5
TimeoutStopSec=10
KillSignal=SIGINT

NoNewPrivileges=yes
PrivateTmp=yes
ProtectSystem=full
ProtectHome=true
ProtectControlGroups=yes
PrivateDevices=no
DeviceAllow=/dev/net/tun rw
RestrictAddressFamilies=AF_INET AF_INET6 AF_NETLINK
ProtectKernelModules=yes
ProtectClock=yes
ProtectHostname=yes
ProtectProc=invisible
LockPersonality=yes
SystemCallFilter=~@mount @swap @clock @module @reboot
MountAPIVFS=yes
MemoryDenyWriteExecute=yes

ReadWritePaths=/proc/sys/net/ipv4/ip_forward /etc/sysctl.d /etc/iptables

[Install]
WantedBy=multi-user.target
EOF

UNIT_CHANGED=0
if [ ! -f "$UNIT_PATH" ] || ! cmp -s "$TMP_UNIT" "$UNIT_PATH"; then
  [ -f "$UNIT_PATH" ] && cp -a "$UNIT_PATH" "${UNIT_PATH}.bak.$(date +%Y%m%d-%H%M%S)"
  install -m 0644 "$TMP_UNIT" "$UNIT_PATH"
  UNIT_CHANGED=1
fi
rm -f "$TMP_UNIT"

# (–æ–ø—Ü.) Drop-in override –¥–ª—è –ª–æ–∫–∞–ª—å–Ω—ã—Ö –ø—Ä–∞–≤–æ–∫ (—Å–æ—Ö—Ä–∞–Ω–∏—Ç—Å—è –º–µ–∂–¥—É –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è–º–∏)
mkdir -p "$DROPIN_DIR"
if [ ! -f "$DROPIN_DIR/override.conf" ]; then
  cat >"$DROPIN_DIR/override.conf" <<'OVR'
[Service]
# –ü—Ä–∏–º–µ—Ä—ã –ª–æ–∫–∞–ª—å–Ω—ã—Ö –¥–æ–±–∞–≤–æ–∫ (–æ—Å—Ç–∞–≤—å –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –∏–ª–∏ –Ω–∞—Å—Ç—Ä–æ–π –ø–æ–¥ —Å–µ–±—è):
#RuntimeDirectory=socks5tun
#ReadWritePaths=/var/log/socks5tun
OVR
fi

# --------- –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–∞ ---------
log "Reloading systemd and restarting service‚Ä¶"
systemctl daemon-reload
systemctl enable --now "$SERVICE_NAME" >/dev/null 2>&1 || true
# –µ—Å–ª–∏ —é–Ω–∏—Ç –∏–∑–º–µ–Ω–∏–ª—Å—è ‚Äî –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏–º –≤ –ª—é–±–æ–º —Å–ª—É—á–∞–µ; –µ—Å–ª–∏ –Ω–µ—Ç ‚Äî —Ç–æ–∂–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏–º –¥–ª—è –ø–æ–¥—Ö–≤–∞—Ç–∞ –Ω–æ–≤–æ–≥–æ wheel
systemctl restart "$SERVICE_NAME"
systemctl status "$SERVICE_NAME" --no-pager -n 20 || true

log "Done."

# --- nginx ws.conf (available) ---
# 1) –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π Connection
map $http_upgrade $connection_upgrade {
    default upgrade;
    ''      close;
}

server {
    listen 80;
    server_name ws.mytunnel.us.com;

    # 2) WS-–≤—Ö–æ–¥: —Ç–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ –ø—É—Ç–∏ (=)
    location = /ws/2i43wj9hqO3alZaBaeiixHQJ {

        # –∫—É–¥–∞ —à—å—ë–º WS
        proxy_pass              http://127.0.0.1:5001;

        # 3) WS must-haves
        proxy_http_version      1.1;
        proxy_set_header        Host $host;
        proxy_set_header        Upgrade $http_upgrade;
        proxy_set_header        Connection $connection_upgrade;

        # 4) –¥–æ–ø. –∑–∞–≥–æ–ª–æ–≤–∫–∏ ‚Äî —á–∞—Å—Ç–æ –ø–æ–º–æ–≥–∞—é—Ç –ø–æ–¥ CF/DPI
        proxy_set_header        X-Forwarded-Proto $scheme;
        proxy_set_header        X-Forwarded-For   $proxy_add_x_forwarded_for;
        proxy_set_header        Origin            https://$host;
        # –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—à—å –ø–æ–¥–ø—Ä–æ—Ç–æ–∫–æ–ª ‚Äî –ø—Ä–æ–±—Ä–∞—Å—ã–≤–∞–µ–º:
        proxy_set_header        Sec-WebSocket-Protocol $http_sec_websocket_protocol;

        # 5) —Ç–∞–π–º–∞—É—Ç—ã –∏ –±—É—Ñ–µ—Ä—ã
        proxy_read_timeout      3600;
        proxy_send_timeout      3600;
        proxy_buffering         off;

        # 6) –æ—Ç–¥–µ–ª—å–Ω—ã–π –ª–æ–≥ –¥–ª—è WS
        access_log /var/log/nginx/ws_access.log;
    }

    # –º–∞—Å–∫–∞ ‚Äî –≤—Å—ë –æ—Å—Ç–∞–ª—å–Ω–æ–µ –ø—Ä—è—á–µ–º
    location / { return 404; }
}

# --- nat6_setup.sh ---
#!/bin/sh
set -e

# Autogenerated by update_socks5tun.sh ‚Äî do not edit manually.
PREFIX6="64"
WAN_IF="eth0"

echo "[nat6_setup] prefix6=$PREFIX6 wan_if=$WAN_IF"

# 1) IPv6 forwarding: —Å–µ–π—á–∞—Å –∏ –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ
sysctl -w net.ipv6.conf.all.forwarding=1 >/dev/null || true
if [ -d /etc/sysctl.d ]; then
  echo 'net.ipv6.conf.all.forwarding=1' >/etc/sysctl.d/99-socks5tun-ipv6.conf || true
fi

# 2) nftables –∏–ª–∏ ip6tables (–≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å–∏—Å—Ç–µ–º—ã)
if command -v nft >/dev/null 2>&1 && nft list tables 2>/dev/null | grep -q ' ip6 nat'; then
  nft list chain ip6 nat POSTROUTING 2>/dev/null | grep -q "ip6 saddr $PREFIX6 oif $WAN_IF masquerade"     || nft add rule ip6 nat POSTROUTING ip6 saddr $PREFIX6 oif $WAN_IF masquerade
  echo "[nat6_setup] nftables rule ensured"
else
  ip6tables -t nat -C POSTROUTING -s "$PREFIX6" -o "$WAN_IF" -j MASQUERADE 2>/dev/null     || ip6tables -t nat -A POSTROUTING -s "$PREFIX6" -o "$WAN_IF" -j MASQUERADE
  if command -v ip6tables-save >/dev/null 2>&1 && [ -d /etc/iptables ]; then
    ip6tables-save > /etc/iptables/rules.v6 || true
  fi
  echo "[nat6_setup] ip6tables rule ensured"
fi

exit 0

# --- resolv.conf ---
nameserver 127.0.0.1

# --- socks5_healthcheck.sh ---
#!/usr/bin/env bash

TOKEN="8285785110:AAGaDAsisuGlbMYDCKkAWuYl_wmgzmEsdLQ"
CHAT_ID="271161868"

STATUS_FILE="/var/lib/node_exporter/socks5tun.prom"
STATE_FILE="/var/lib/socks5health/last_status"

# –°–æ–∑–¥–∞—ë–º –ø–∞–ø–∫—É –¥–ª—è STATE_FILE, –µ—Å–ª–∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
mkdir -p "$(dirname "$STATE_FILE")"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —á–µ—Ä–µ–∑ SOCKS5
if curl -sS -4 --max-time 8 --socks5-hostname 127.0.0.1:5000 https://ifconfig.co > /dev/null; then
    CURRENT="up"
    systemd-notify --status="SOCKS5 OK" --ready
    echo "socks5tun_status 1" > "$STATUS_FILE"
else
    CURRENT="down"
    systemd-notify --status="SOCKS5 ERROR"
    echo "socks5tun_status 0" > "$STATUS_FILE"
fi

# –ß–∏—Ç–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
PREV=$(cat "$STATE_FILE" 2>/dev/null || echo "unknown")

# –û—Ç–ø—Ä–∞–≤–∫–∞ Telegram —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Å—Ç–∞—Ç—É—Å –∏–∑–º–µ–Ω–∏–ª—Å—è
if [[ "$CURRENT" == "up" && "$PREV" != "up" ]]; then
    curl -s -X POST https://api.telegram.org/bot${TOKEN}/sendMessage \
         -d chat_id=${CHAT_ID} \
         -d text="‚úÖ SOCKS5TUN –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –Ω–∞ $(hostname) –≤ $(date)" > /dev/null
elif [[ "$CURRENT" == "down" && "$PREV" != "down" ]]; then
    curl -s -X POST https://api.telegram.org/bot${TOKEN}/sendMessage \
         -d chat_id=${CHAT_ID} \
         -d text="üö® SOCKS5TUN –ù–ï –†–ê–ë–û–¢–ê–ï–¢ –Ω–∞ $(hostname) –≤ $(date)" > /dev/null
fi

# –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
echo "$CURRENT" > "$STATE_FILE"

# –ö–æ–¥ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
[[ "$CURRENT" == "up" ]] && exit 0 || exit 1

# --- ws-bridge.service ---
[Unit]
Description=WebSocket <-> TCP bridge (websocat)
After=network-online.target
Wants=network-online.target

[Service]
User=wsbridge
Group=nogroup
ExecStart=/usr/local/bin/websocat --binary -E ws-l:127.0.0.1:5001 tcp:127.0.0.1:5000
Restart=always
RestartSec=1

# –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
NoNewPrivileges=yes
ProtectSystem=full
ProtectHome=yes
PrivateTmp=yes
LockPersonality=yes

[Install]
WantedBy=multi-user.target

# --- socks5_healthcheck.timer ---
[Unit]
Description=Run SOCKS5TUN health-probe every 5 minutes

[Timer]
OnBootSec=5min
OnUnitActiveSec=5min
Persistent=true

[Install]
WantedBy=timers.target

# --- restart-socks5tun@.service ---
[Unit]
Description=Auto-restart SOCKS5TUN when %i fails

[Service]
Type=oneshot
ExecStart=/bin/systemctl restart socks5tun


# --- nginx ws.conf symlink ---
lrwxrwxrwx 1 root root 34 Aug 10 09:38 /etc/nginx/sites-enabled/ws.conf -> /etc/nginx/sites-available/ws.conf

# --- nginx ws.conf (resolved target) ---
# 1) –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π Connection
map $http_upgrade $connection_upgrade {
    default upgrade;
    ''      close;
}

server {
    listen 80;
    server_name ws.mytunnel.us.com;

    # 2) WS-–≤—Ö–æ–¥: —Ç–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ –ø—É—Ç–∏ (=)
    location = /ws/2i43wj9hqO3alZaBaeiixHQJ {

        # –∫—É–¥–∞ —à—å—ë–º WS
        proxy_pass              http://127.0.0.1:5001;

        # 3) WS must-haves
        proxy_http_version      1.1;
        proxy_set_header        Host $host;
        proxy_set_header        Upgrade $http_upgrade;
        proxy_set_header        Connection $connection_upgrade;

        # 4) –¥–æ–ø. –∑–∞–≥–æ–ª–æ–≤–∫–∏ ‚Äî —á–∞—Å—Ç–æ –ø–æ–º–æ–≥–∞—é—Ç –ø–æ–¥ CF/DPI
        proxy_set_header        X-Forwarded-Proto $scheme;
        proxy_set_header        X-Forwarded-For   $proxy_add_x_forwarded_for;
        proxy_set_header        Origin            https://$host;
        # –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—à—å –ø–æ–¥–ø—Ä–æ—Ç–æ–∫–æ–ª ‚Äî –ø—Ä–æ–±—Ä–∞—Å—ã–≤–∞–µ–º:
        proxy_set_header        Sec-WebSocket-Protocol $http_sec_websocket_protocol;

        # 5) —Ç–∞–π–º–∞—É—Ç—ã –∏ –±—É—Ñ–µ—Ä—ã
        proxy_read_timeout      3600;
        proxy_send_timeout      3600;
        proxy_buffering         off;

        # 6) –æ—Ç–¥–µ–ª—å–Ω—ã–π –ª–æ–≥ –¥–ª—è WS
        access_log /var/log/nginx/ws_access.log;
    }

    # –º–∞—Å–∫–∞ ‚Äî –≤—Å—ë –æ—Å—Ç–∞–ª—å–Ω–æ–µ –ø—Ä—è—á–µ–º
    location / { return 404; }
}

# --- /var/log/nginx/ws_access.log (tail -n 20) ---
104.23.223.43 - - [10/Aug/2025:10:57:44 +0000] "GET /ws/2i43wj9hqO3alZaBaeiixHQJ HTTP/1.1" 101 0 "-" "-"
104.23.221.186 - - [10/Aug/2025:11:00:55 +0000] "GET /ws/2i43wj9hqO3alZaBaeiixHQJ HTTP/1.1" 101 4 "-" "-"
104.23.221.10 - - [10/Aug/2025:11:16:48 +0000] "GET /ws/2i43wj9hqO3alZaBaeiixHQJ HTTP/1.1" 101 0 "-" "-"
104.23.223.86 - - [10/Aug/2025:11:29:58 +0000] "GET /ws/2i43wj9hqO3alZaBaeiixHQJ HTTP/1.1" 101 4 "-" "-"
104.23.221.182 - - [10/Aug/2025:11:32:40 +0000] "GET /ws/2i43wj9hqO3alZaBaeiixHQJ HTTP/1.1" 400 55 "-" "curl/8.5.0"
104.23.221.146 - - [10/Aug/2025:13:05:02 +0000] "GET /ws/2i43wj9hqO3alZaBaeiixHQJ HTTP/1.1" 101 4 "-" "-"
104.23.221.147 - - [10/Aug/2025:13:09:21 +0000] "GET /ws/2i43wj9hqO3alZaBaeiixHQJ HTTP/1.1" 101 4 "-" "-"
104.23.223.49 - - [10/Aug/2025:13:13:33 +0000] "GET /ws/2i43wj9hqO3alZaBaeiixHQJ HTTP/1.1" 101 4 "-" "-"
